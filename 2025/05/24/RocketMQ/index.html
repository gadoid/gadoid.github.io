

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/%5Bobject%20Object%5D">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Codfish">
  <meta name="keywords" content="">
  
    <meta name="description" content="JMSjava消息服务（Java Message Service) Java平台中关于面向消息中间件的接口 JMS 提供者 ： 连接面向消息中间件，JMS接口的一个实现 JMS 生产者 ：Message Producer 生产消息的服务 JMS 消费者 ：Message Consumer 消费消息的服务 JMS 消息  ：  数据对象 JMS 队列 ： 存储待消费消息的区域 JMS 主题 ： 一种">
<meta property="og:type" content="article">
<meta property="og:title" content="RocketMQ">
<meta property="og:url" content="http://gadoid.io/2025/05/24/RocketMQ/index.html">
<meta property="og:site_name" content="西北有高楼">
<meta property="og:description" content="JMSjava消息服务（Java Message Service) Java平台中关于面向消息中间件的接口 JMS 提供者 ： 连接面向消息中间件，JMS接口的一个实现 JMS 生产者 ：Message Producer 生产消息的服务 JMS 消费者 ：Message Consumer 消费消息的服务 JMS 消息  ：  数据对象 JMS 队列 ： 存储待消费消息的区域 JMS 主题 ： 一种">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.111666.best/image/Pi5eVZIEUL0u25mHhK03aP.png">
<meta property="article:published_time" content="2025-05-23T16:34:42.000Z">
<meta property="article:modified_time" content="2025-05-23T16:38:28.610Z">
<meta property="article:author" content="Codfish">
<meta property="article:tag" content="中间件">
<meta property="article:tag" content="RocketMQ">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.111666.best/image/Pi5eVZIEUL0u25mHhK03aP.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>RocketMQ - 西北有高楼</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gadoid.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>西北有高楼</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/downloads" target="_self">
                
                <span>资源下载</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="RocketMQ"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-05-24 00:34" pubdate>
          2025年5月24日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          28 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">RocketMQ</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h1><p>java消息服务（Java Message Service) Java平台中关于面向消息中间件的接口</p>
<p>JMS 提供者 ： 连接面向消息中间件，JMS接口的一个实现</p>
<p>JMS 生产者 ：Message Producer 生产消息的服务</p>
<p>JMS 消费者 ：Message Consumer 消费消息的服务</p>
<p>JMS 消息  ：  数据对象</p>
<p>JMS 队列 ： 存储待消费消息的区域</p>
<p>JMS 主题 ： 一种支持发送消息给多个订阅者的机制</p>
<p>JMS消息通常由两种类型 ： 点对点 ，发布&#x2F;订阅</p>
<h2 id="基础编程模型"><a href="#基础编程模型" class="headerlink" title="基础编程模型"></a>基础编程模型</h2><p>MQ中的一些原生类</p>
<p>ConnectionFactory ： 连接工厂 ， JMS 用它创建链接</p>
<p>Connection ： JMS 客户端到JMS Provider的连接</p>
<p>Session ： 一个发送或接收消息的线程</p>
<p>Destination ： 消息的目的地 </p>
<p>MessageConsumer  ： MessageProducer 消息消费者，消息生产者</p>
<h1 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h1><ul>
<li>支持Broker和Consumer端消息过滤</li>
<li>支持发布&#x2F;订阅模型，和点对点</li>
<li>支持拉pull和推push两种消息模式</li>
<li>单一队列百万消息，亿级消息堆积</li>
<li>支持单master节点，多master节点，多master多slave节点</li>
<li>任意一点都是高可用，水平拓展，Producer,Consumer, 队列都可以分布式</li>
<li>消息失败重试机制，支持定义level的定制消息</li>
<li>底层采用netty</li>
<li>支持分布式事务</li>
</ul>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul>
<li>Producer 消息生产者</li>
<li>Producer Group 消息生产者组</li>
<li>Consumer 消费者</li>
<li>Consumer Group 消费同类消息的多个示例</li>
<li>Tag ： 标签，子主题（二级分类）对topic的进一步细化，用于区分同一个主题下的不同业务消息</li>
<li>Topic主题， 逻辑管理单位 一个topic下可以有多个queue</li>
<li>Message 消息 每个message 必须指定一个topic</li>
<li>Broker MQ程序，接收生成的消息，提供给消费者消费的程序</li>
<li>Name Server 给生成和消费者提供路由信息，提供轻量级的路由发现，路由，元数据信息。可以多个部署，互相独立</li>
<li>Offset 偏移量</li>
<li>commit log ：消息存储会写在Commit log文件里</li>
</ul>
<h1 id="工程实现"><a href="#工程实现" class="headerlink" title="工程实现"></a>工程实现</h1><h2 id="普通消息发送"><a href="#普通消息发送" class="headerlink" title="普通消息发送"></a>普通消息发送</h2><h3 id="同步发送"><a href="#同步发送" class="headerlink" title="同步发送"></a>同步发送</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncProducer</span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args )</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQproducer</span>(<span class="hljs-string">&quot;group_test&quot;</span>);<br>		<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		<span class="hljs-comment">//producer.setSendLatencyFaultEnable(true);</span><br>		producer.start();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ;i &lt; <span class="hljs-number">10</span> ; i++)&#123;<br>			<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;TopicTest&quot;</span>,<span class="hljs-string">&quot;TagA&quot;</span>,(<span class="hljs-string">&quot;Hello RocketMQ&quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET)<br>		&#125;;<br>		<span class="hljs-type">SendResult</span> <span class="hljs-variable">sendResult</span> <span class="hljs-operator">=</span> producer.send(msg);<br>		System.out.printf(<span class="hljs-string">&quot;%s%n&quot;</span>,sendResult);<br>	&#125;<br>	producer.shutdown();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="异步发送"><a href="#异步发送" class="headerlink" title="异步发送"></a>异步发送</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncProducer</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;group_test&quot;</span>);<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		producer.start();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">10</span> ; i++)&#123;<br>			<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> i ;<br>			<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;TopicTest&quot;</span>,<span class="hljs-string">&quot;TagA&quot;</span>,<span class="hljs-string">&quot;OrderID888&quot;</span>);<br>			producer.send(msg, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendCallback</span>()&#123;<br>					<span class="hljs-meta">@Override</span><br>					<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(SendResult sendResult)</span>&#123;<br>						System.out.printf(<span class="hljs-string">&quot;%s%n&quot;</span>,sendResult);					<br>					&#125;<br>					<span class="hljs-meta">@Override</span><br>					<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onException</span><span class="hljs-params">(Throwable e)</span>&#123;<br>						System.out.printf(<span class="hljs-string">&quot;%-10d Exception %s %n &quot;</span>,index,e);<br>						e.printStackTrace();<br>					&#125;	<br>			&#125;);<br>		&#125;<br>		Thread.sleep(<span class="hljs-number">10000</span>);<br>		producer.shutdown();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="单向发送"><a href="#单向发送" class="headerlink" title="单向发送"></a>单向发送</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OnewayProducer</span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;group_test&quot;</span>);<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		producer.start();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">10</span> ; i++)&#123;<br>			<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;TopicTest&quot;</span>,<span class="hljs-string">&quot;TagA&quot;</span>,(<span class="hljs-string">&quot;Hello RocketMQ&quot;</span> + i).getBytes(RemotingHelper.DEFAULT_CHARSET)<br>			);		<br>			producer.sendOneWay(msg);<br>		&#125;<br>		producer.shutdown();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="普通消息的消费模式"><a href="#普通消息的消费模式" class="headerlink" title="普通消息的消费模式"></a>普通消息的消费模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">consumer.setMessageModel(MessageModel.CLUSTERING);<br><span class="hljs-comment">// 设置集群消费模式，轮询投递给每个消费者</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">consumer.setMessageModel(MessageModel.Boardcasting);<br><span class="hljs-comment">// 设置广播消费模式, 每个消费者都获取同样的消息</span><br></code></pre></td></tr></table></figure>

<h2 id="顺序消息"><a href="#顺序消息" class="headerlink" title="顺序消息"></a>顺序消息</h2><h3 id="顺序消息-1"><a href="#顺序消息-1" class="headerlink" title="顺序消息"></a>顺序消息</h3><p>同一个queue中会顺序消费</p>
<h3 id="部分顺序消息"><a href="#部分顺序消息" class="headerlink" title="部分顺序消息"></a>部分顺序消息</h3><p>向同一个序列中某个流程的执行过程是有序的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 生产方</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerInOrder</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;OrderProducer&quot;</span>);<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		producer.start();<br>		List&lt;Order&gt; orderList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerInOrder</span>().buildOrders();<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; orderList.size();i++)&#123;<br>			<span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> orderList.get(i).toString();<br>			<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;PartOrder”,null,&quot;</span>KEY<span class="hljs-string">&quot;+i,body.getBytes());</span><br><span class="hljs-string">			SendResult sendResult = producer.send(msg,new MessageQueueSelector()&#123;</span><br><span class="hljs-string">				@Override</span><br><span class="hljs-string">				public MessageQueue select(List&lt;MessageQueue&gt;mqs, Message msg , Object arg)&#123;</span><br><span class="hljs-string">					@Override</span><br><span class="hljs-string">					public MessageQueue select(List&lt;MessageQueue&gt;mqs , Message msg , Object arg)&#123;</span><br><span class="hljs-string">						Long id = (Long) arg;</span><br><span class="hljs-string">						long index = id % mqs.size();</span><br><span class="hljs-string">						return mqs.get((int)index);</span><br><span class="hljs-string">					&#125;</span><br><span class="hljs-string">				&#125;, orderList.get(i).getOrderId());</span><br><span class="hljs-string">				System.out.println(String.format(&quot;</span>SendResult status %s ,queueId: %d , body: %s<span class="hljs-string">&quot;,</span><br><span class="hljs-string">									sendResult.getSendStatus(),</span><br><span class="hljs-string">									sendResult.getMessageQueue().getQueueId(),</span><br><span class="hljs-string">									body));</span><br><span class="hljs-string">			&#125;</span><br><span class="hljs-string">			producer.shutdown();</span><br><span class="hljs-string">		&#125;</span><br><span class="hljs-string">	&#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">// 消费方</span><br><span class="hljs-string">public class ConsumerInOrder &#123;</span><br><span class="hljs-string">	public static void main(String[] args ) throws Exception&#123;</span><br><span class="hljs-string">		DefaultMQPushConsumer consumer = new DefaultMQPsuhConsumer(&quot;</span>OrderConsumer2<span class="hljs-string">&quot;);</span><br><span class="hljs-string">		consumer.setNamesrvAddr(&quot;</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">9876</span><span class="hljs-string">&quot;);</span><br><span class="hljs-string">		consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUM_FROM_LAST_OFFSET);</span><br><span class="hljs-string">		consumer.subscribe(&quot;</span>PartOrder<span class="hljs-string">&quot;,&quot;</span>*<span class="hljs-string">&quot;);</span><br><span class="hljs-string">		consumer.registerMessageListener(new MessageListenerOrderly()&#123;</span><br><span class="hljs-string">				Random random = new Random();</span><br><span class="hljs-string">				@Override</span><br><span class="hljs-string">					public ConsumeOrderlyStatus consumeMessage(List&lt;MessageExt&gt; msgs, ConsumeOrderlyContext context)&#123;</span><br><span class="hljs-string">						context.setAutoCommit(true);</span><br><span class="hljs-string">						for(MessageExt msg : msgs )&#123;</span><br><span class="hljs-string">							System.out.println(&quot;</span>consumeThread=<span class="hljs-string">&quot; + Thread.currentThread().getName()</span><br><span class="hljs-string">									+&quot;</span>,queueId=<span class="hljs-string">&quot; + msg.getQueueId() + &quot;</span>,content:<span class="hljs-string">&quot; + new String(msg.getbody()));</span><br><span class="hljs-string">						&#125;</span><br><span class="hljs-string">						try &#123;</span><br><span class="hljs-string">							TimeUnit.MILLISECONDS.sleep(random.nextInt(300));</span><br><span class="hljs-string">						&#125; catch (Exception e)&#123;</span><br><span class="hljs-string">							e.printStackTrace();</span><br><span class="hljs-string">							return ConsumeOrderlyStatus.SUSPEND_CURRENT_QUEUE_A_MOMENT;</span><br><span class="hljs-string">						&#125;</span><br><span class="hljs-string">						return ConsumeOrderlyStatus.SUCCESS;					</span><br><span class="hljs-string">					&#125;</span><br><span class="hljs-string">		</span><br><span class="hljs-string">		&#125;)</span><br><span class="hljs-string">	</span><br><span class="hljs-string">	&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="延迟消息"><a href="#延迟消息" class="headerlink" title="延迟消息"></a>延迟消息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 生产者</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduledMessageProducer</span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>			<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;ScheduledProducer&quot;</span>);<br>			producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>			producer.start();<br>			<span class="hljs-type">int</span> <span class="hljs-variable">totalMessagesToSend</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span> ;<br>			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; totalMessagesToSend ; i++)&#123;<br>				<span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;ScheduledTopic&quot;</span>,(<span class="hljs-string">&quot;Hello scheduled message&quot;</span>+i).getBytes());<br>				message.setDelayTimeLevel(<span class="hljs-number">4</span>);<br>				producer.send(message);<br>			&#125;<br>			producer.shutdown();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="批量消息"><a href="#批量消息" class="headerlink" title="批量消息"></a>批量消息</h3><p>一次性发送多条消息，但是注意总大小不能超过4M，否则会阻塞消费</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchMessageProducer</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;BatchProducer&quot;</span>);<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		producer.start();<br>		<span class="hljs-type">String</span> <span class="hljs-variable">topic</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;BatchTest&quot;</span>;<br>		List&lt;Message&gt; messages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>		messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, <span class="hljs-string">&quot;Tag&quot;</span>, <span class="hljs-string">&quot;OrderID001&quot;</span>,<span class="hljs-string">&quot;HelloWorld1&quot;</span>.getBytes()));<br>		messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, <span class="hljs-string">&quot;Tag&quot;</span>, <span class="hljs-string">&quot;OrderID002&quot;</span>,<span class="hljs-string">&quot;HelloWorld2&quot;</span>.getBytes()));<br>		messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, <span class="hljs-string">&quot;Tag&quot;</span>, <span class="hljs-string">&quot;OrderID003&quot;</span>,<span class="hljs-string">&quot;HelloWorld3&quot;</span>.getBytes()));<br>		messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, <span class="hljs-string">&quot;Tag&quot;</span>, <span class="hljs-string">&quot;OrderID004&quot;</span>,<span class="hljs-string">&quot;HelloWorld4&quot;</span>.getBytes()));<br>		messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, <span class="hljs-string">&quot;Tag&quot;</span>, <span class="hljs-string">&quot;OrderID005&quot;</span>,<span class="hljs-string">&quot;HelloWorld5&quot;</span>.getBytes()));<br>		messages.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, <span class="hljs-string">&quot;Tag&quot;</span>, <span class="hljs-string">&quot;OrderID006&quot;</span>,<span class="hljs-string">&quot;HelloWorld6&quot;</span>.getBytes()));<br>		<span class="hljs-keyword">try</span> &#123;<br>			producer.send(messages);			<br>		&#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>			producer.shutdown();<br>			e.printStactkTrace();			<br>		&#125;<br>		producer.shutdown();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="过滤消息"><a href="#过滤消息" class="headerlink" title="过滤消息"></a>过滤消息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 生产端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TagFilterProducer</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;TagFilterProducer&quot;</span>);<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		producer.start();<br>		String[] tags = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123;<span class="hljs-string">&quot;TagA&quot;</span>,<span class="hljs-string">&quot;TagB&quot;</span>,<span class="hljs-string">&quot;TagC&quot;</span>&#125;;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">3</span> ; i++)&#123;<br>			<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;TagFilterTest&quot;</span>);<br>				tags[i % tags.length],<br>				<span class="hljs-string">&quot;Hello world&quot;</span>.getBytes(RemotingHelper.DEFAULT_CHARSET));<br>			<span class="hljs-type">SendResult</span> <span class="hljs-variable">sendResult</span> <span class="hljs-operator">=</span> producer.send(msg);<br>			System.out.printf(<span class="hljs-string">&quot;%s%n&quot;</span>,sendResult);<br>		&#125;<br>		producer.shutdown();<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 消费端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TagFilterConsumer</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">&quot;TagFilterConsumer&quot;</span>);<br>		consumer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		consumer.subscribe(<span class="hljs-string">&quot;TagFilterTest&quot;</span>,<span class="hljs-string">&quot;TagA||TagB&quot;</span>);<br>		consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>()&#123;<br>			<span class="hljs-meta">@Override</span><br>				<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumerMessage</span><span class="hljs-params">(List&lt;MessageExt&gt;msgs ,</span><br><span class="hljs-params">							ConsumeConcurrentlyContext context)</span>&#123;<br>					<span class="hljs-keyword">try</span> &#123;<br>						<span class="hljs-keyword">for</span>(MessageExt msg : msgs)&#123;<br>							<span class="hljs-type">String</span> <span class="hljs-variable">topic</span> <span class="hljs-operator">=</span> msg.getTopic();<br>							<span class="hljs-type">String</span> <span class="hljs-variable">msgBody</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody(),<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>							<span class="hljs-type">String</span> <span class="hljs-variable">msgPro</span> <span class="hljs-operator">=</span> msg.getProperty(<span class="hljs-string">&quot;a&quot;</span>);<br>							<span class="hljs-type">String</span> <span class="hljs-variable">tags</span> <span class="hljs-operator">=</span> msg.getTags();<br>							System.out.println(<span class="hljs-string">&quot;收到消息&quot;</span>+ topic + <span class="hljs-string">&quot;tags&quot;</span> + tags + <span class="hljs-string">&quot;a:&quot;</span> + msgPro + <span class="hljs-string">&quot;,msg：&quot;</span> +msgBody);<br>						&#125;<br>					&#125;	<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>							e.printStackTrace();	<br>				  &#125;	<br>			&#125;<br>		&#125;)<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="核心方法"><a href="#核心方法" class="headerlink" title="核心方法"></a>核心方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 生产</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerDetails</span> &#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;producer_details&quot;</span>);<br>		<span class="hljs-comment">// 生产者所属组</span><br>		producer.setDefaultTopicQueuenums(num);<br>		<span class="hljs-comment">// 默认主题在每一个Brokcer队列数量</span><br>		producer.setSendMsgTimeout(<span class="hljs-number">1000</span>*<span class="hljs-number">3</span>);<br>		<span class="hljs-comment">// 发送消息默认超时时间</span><br>		producer.setCompressMsgBodyOverHowmuch(<span class="hljs-number">1024</span>*<span class="hljs-number">4</span>);<br>		<span class="hljs-comment">// 超过限值启动压缩功能</span><br>		producer.setRetryTimesWhenSendFailed(<span class="hljs-number">2</span>);<br>		<span class="hljs-comment">// 同步方式发送消息重试次数</span><br>		producer.setRetryTimesWhenSendAsyncFailed(<span class="hljs-number">2</span>);<br>		<span class="hljs-comment">// 异步方式发送消息重试次数</span><br>		producer.setRetryAnotherBrokerWhenNotStoreOK(<span class="hljs-literal">false</span>);<br>		<span class="hljs-comment">// 消息重试时选择另一个Broker</span><br>		producer.setMaxMessageSize(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">4</span>);<br>		<span class="hljs-comment">// 允许发送的最大长度信息</span><br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;106.55.246.66.9876&quot;</span>);<br>		<span class="hljs-comment">// nameserver 地址</span><br>		producer.start();		<br>	&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumerDetails</span> &#123;<br>		<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>			<span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">&quot;king&quot;</span>);<br>			<span class="hljs-comment">// 消费者组</span><br>			consumer.setNamesrvAddr(<span class="hljs-string">&quot;106.55.246.66:9876&quot;</span>);<br>			<span class="hljs-comment">// 设置nameserver</span><br>			consumer.setMessageModel(MessageModel.CLUSTERING);<br>			<span class="hljs-comment">// 设置消费模式</span><br>			consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);<br>			<span class="hljs-comment">// 设置消费开始偏移量</span><br>			consumer.setConsumeThreadMin(<span class="hljs-number">20</span>);<br>			<span class="hljs-comment">// 消费者最小线程数量</span><br>			consumer.setConsumeThreadMax(<span class="hljs-number">20</span>);<br>			<span class="hljs-comment">// 消费者最大线程数量</span><br>			consumer.setPullInterval(<span class="hljs-number">0</span>);<br>			<span class="hljs-comment">// 推模式下任务时间间隔</span><br>			consumer.setPullBatchSize(<span class="hljs-number">32</span>);<br>			<span class="hljs-comment">// 推模式下拉去的条数</span><br>			consumer.setMaxReconsumeTimes(-<span class="hljs-number">1</span>);<br>			<span class="hljs-comment">// 消息重试次数</span><br>			consumer.setConsumeTimeout(<span class="hljs-number">15</span>);<br>	<br>			Set&lt;MessageQueue&gt; MessageQueueSet = consumer.fetchSubscribeMessageQueues(<span class="hljs-string">&quot;TopicTest&quot;</span>);<br>			<span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> MessageQueueSet.iterator();<br>			<span class="hljs-keyword">while</span>(iterator.hasNext())&#123;<br>				<span class="hljs-type">MessageQueue</span> <span class="hljs-variable">MessageQueue</span> <span class="hljs-operator">=</span> (MessageQueue)iterator.next();<br>				System.out.println(MessageQueue.getQueueId());<br>			&#125;<br>			consumer.subscribe(<span class="hljs-string">&quot;TopicTest&quot;</span>,<span class="hljs-string">&quot;*&quot;</span>);<br>			consumer.subscribe(<span class="hljs-string">&quot;TopicTest&quot;</span>,MessageSelector.bySql());<br>			consumer.subscribe(<span class="hljs-string">&quot;TopicTest&quot;</span>,MessageSelector.byTag());<br>			consumer.unsubscribe(<span class="hljs-string">&quot;TopicTest&quot;</span>);<br>			<span class="hljs-comment">// 筛选订阅</span><br>			<br>			consumer.registerMessageListner(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>()&#123;<br>				<span class="hljs-meta">@Override</span><br>				<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs,</span><br><span class="hljs-params">							ConsumeConcurrentlyContext Context)</span>;<br>							<span class="hljs-keyword">try</span> &#123;<br>								<span class="hljs-keyword">for</span>(MessageExt msg : msgs)&#123;<br>									<span class="hljs-type">String</span> <span class="hljs-variable">topic</span> <span class="hljs-operator">=</span> msg.getTopic();<br>									<span class="hljs-type">String</span> <span class="hljs-variable">msgBody</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(msg.getBody(),<span class="hljs-string">&quot;utf-8&quot;</span>);<br>									<span class="hljs-type">String</span> <span class="hljs-variable">tags</span> <span class="hljs-operator">=</span> msg.getTags();<br>									System.out.println(<span class="hljs-string">&quot;收到消息：&quot;</span> + <span class="hljs-string">&quot;topic : &quot;</span> + topic + <span class="hljs-string">&quot;, tags :&quot;</span> + tags + “,msg:” + msgBody );<br>									&#125;							<br>							&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>								e.printStackTrace();<br>								<span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;<br>							&#125;<br>							<span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>							&#125;<br>			&#125;);<br>			<span class="hljs-comment">// 并发监听</span><br>			consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerOrderly</span>()&#123;<br>				<span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>				<span class="hljs-meta">@Override</span><br>				<span class="hljs-keyword">public</span> ConsumeOrderlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt;msgs,ConsumeOrderlyContext Context)</span>&#123;<br>					context.setAutoCommit(<span class="hljs-literal">true</span>);<br>					<span class="hljs-keyword">for</span>(MessageExt msg : msgs)&#123;<br>						System.out.println(<span class="hljs-string">&quot;consumeThread=&quot;</span> + Thread.currentThread().getName()+<span class="hljs-string">&quot;queueId=&quot;</span><br>						+ msg.getQueueId() + <span class="hljs-string">&quot;,content&quot;</span>);<br>					&#125;<br>					<span class="hljs-keyword">try</span> &#123;<br>						TimeUnit.MILLISECONDS.sleep(random.nextInt(<span class="hljs-number">300</span>));<br>					&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>						e.printStackTrace();<br>						<span class="hljs-keyword">return</span> ConsumeOrderlyStatus.SUSPEND_CURRENT_QUEUE_A_MOMENT;<br>					&#125;<span class="hljs-keyword">return</span> ConsumeOrderlyStatus.SUCCESS;				<br>				&#125;<br>			&#125;);<br>			<span class="hljs-comment">// 顺序监听</span><br>			consumer.start();<br>			&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="集群部署"><a href="#集群部署" class="headerlink" title="集群部署"></a>集群部署</h1><h2 id="单master-模式"><a href="#单master-模式" class="headerlink" title="单master 模式"></a>单master 模式</h2><h2 id="多master-模式"><a href="#多master-模式" class="headerlink" title="多master 模式"></a>多master 模式</h2><h2 id="多master-多slave模式（同步）"><a href="#多master-多slave模式（同步）" class="headerlink" title="多master 多slave模式（同步）"></a>多master 多slave模式（同步）</h2><h2 id="多master-多slave-模式（异步）"><a href="#多master-多slave-模式（异步）" class="headerlink" title="多master 多slave 模式（异步）"></a>多master 多slave 模式（异步）</h2><h2 id="多master-多slave-持久化（硬盘写入）"><a href="#多master-多slave-持久化（硬盘写入）" class="headerlink" title="多master 多slave + 持久化（硬盘写入）"></a>多master 多slave + 持久化（硬盘写入）</h2><h1 id="存储设计"><a href="#存储设计" class="headerlink" title="存储设计"></a>存储设计</h1><p><img src="https://i.111666.best/image/Pi5eVZIEUL0u25mHhK03aP.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>可以看到Rocket 分为4个块</p>
<ol>
<li>Message 消息生成者，向对应的Topic 发布消息</li>
<li>Topic 主题，消息携带的标志信息，还可以使用tags做进一步细分</li>
<li>Queue&#x2F;Offset  Queue实际上的消息分发队列，Offset记录消息的读取位置</li>
<li>Group  消费者组，同一消费者组共享消费策略</li>
</ol>
<h2 id="顺序和重复问题"><a href="#顺序和重复问题" class="headerlink" title="顺序和重复问题"></a>顺序和重复问题</h2><p>RocketMQ 没有提供防止乱序和重复的机制。因为</p>
<ol>
<li>乱序应用实际大量存在</li>
<li>队列无序并不意味着消息无序</li>
</ol>
<p>重复问题</p>
<ol>
<li>消息端处理消息的业务逻辑保持幂等性</li>
<li>确保每一条消息都有唯一的编号且保证消息处理成功与去重表的日志同时出现。</li>
</ol>
<h1 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h1><p>RocketMQ消息的存储是由ConsumeQueue 和 CommitLog 配合完成的，消息真正的物理存储文件是CommitLog，ConsumeQueue是消息的逻辑队列。类似数据库的索引文件。存储的是指向物理存储的地址。每个Topic下的每个Message Queue都有一个对应的ComsumeQueue文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">Commitlog <br>-------------------------------------------------<br>  消息长度 | 消息其他信息 | 消息长度 | 消息其他信息<br>  <br> <span class="hljs-comment">// 每个CommitLog文件的大小为1G，写完之后记录偏移量为1G的位置继续写入</span><br> <br> ComsumeQueue<br> ------------------------------------------------<br> commitLogOffset  | size        |    tag hashcode <br> <span class="hljs-comment">// ComsumeQueue 是消息的逻辑队列，类似数据库索引，存储的是指向物理存储的地址</span><br> <span class="hljs-comment">// 文件默认存储在 $&#123;ROCKETMQ_HOME&#125;/store/consumequeue/&#123;topic&#125;/&#123;queueId&#125;/</span><br><br>Index <br>index 存储了索引文件，用于加快Key查询时的 查询速度 结构为Hash槽与Hash冲突的链表结构<br><br>Config<br><br>存储Topic 和 Consumer 等相关信息<br>topics.json : topic 配置属性<br>subscriptionGroup.json : 消息消费组配置信息<br>delayOffset.json : 延迟消息队列拉取进度<br>consumerOffset.json :  集群消费模式消息进度<br>consumerFilter.json : 主题消息过滤信息<br><br></code></pre></td></tr></table></figure>

<h1 id="文件删除"><a href="#文件删除" class="headerlink" title="文件删除"></a>文件删除</h1><p>如果非当前写文件在一定时间间隔内没有再次被更新，则认为是过期文件。RocketMQ不会关注这个文件中的消息是否全部被消费，默认过期时间为42小时</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">fileReservedTime   未更新时间<br>deletePhysicFileInterval  删除物理文件的时间间隔<br>destroyMapedFileIntervalForcibly   删除时发现还有线程在引用，会阻止删除操作<br>deleteWhen         定时删除文件<br>DiskSpcaeCleanForciblyRatio  磁盘控件默认水位<br>diskSpaceWarningLevelRatio   使用率大于这个值，阻止写入<br>diskMaxUsedSpaceRatio        小于这个值，表示使用正常<br></code></pre></td></tr></table></figure>

<h1 id="零拷贝"><a href="#零拷贝" class="headerlink" title="零拷贝"></a>零拷贝</h1><p>1 可以减少数据拷贝和共享总线操作的次数</p>
<p>2 减少用户空间到内核空间切换的上下文开销</p>
<h2 id="传统机制"><a href="#传统机制" class="headerlink" title="传统机制"></a>传统机制</h2><p>1  磁盘 读取到 内核缓冲区</p>
<p>2 内核缓冲区拷贝到用户空间</p>
<p>3 用户空间拷贝到socket缓冲区</p>
<p>4 socket缓冲区拷贝到socket网卡</p>
<h2 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h2><p>将用户文件直接映射到用户空间内容</p>
<h1 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h1><p>事务的执行需要保持ACID 原则  一致性，持久性，隔离性，原子性。</p>
<p>而当A系统的事务需要B系统参与时，A系统无法完全控制在B系统上的执行过程（比如断网）</p>
<p>这时就会出现分布式事务问题</p>
<h2 id="异步化"><a href="#异步化" class="headerlink" title="异步化"></a>异步化</h2><p>通过MQ，可以为事务当前的处理流程标记一个“状态”。这样对于A系统来说，事务的执行过程仍然是可控的。</p>
<p>但是响应过程会存在如下问题 ： 当A系统生产了信息交给MQ发送给B系统后，何时发出对B给出结果的响应？ </p>
<ol>
<li>先执行，后传递消息 ———- 出现通信问题，B系统执行失败。导致两端不一致</li>
<li>先传递消息，后执行 ———- 出现通信问题，B系统执行。但是消息未发回导致两端不一致。</li>
</ol>
<h2 id="半事务消息-事务回查"><a href="#半事务消息-事务回查" class="headerlink" title="半事务消息&#x2F;事务回查"></a>半事务消息&#x2F;事务回查</h2><ol>
<li>向MQ存储一个commitlog，不创建consumerqueue</li>
<li>后续MQ 进行事务回查，如果成功了，创建consumerqueue加入队列，如果失败了则回滚。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionProducer</span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>		<span class="hljs-type">TransactionListener</span> <span class="hljs-variable">transactionListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionListenerImpl</span>();<br>		<span class="hljs-type">TranscationMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionMQProducer</span>(<span class="hljs-string">&quot;TransactionProducer&quot;</span>);	<br>		producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>		<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">100</span>)&#123;;<br>			<span class="hljs-meta">@Override</span> <br>			<span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span>&#123;<br>				<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);<br>				thread.setName(<span class="hljs-string">&quot;client-transcation-msg-check-thread&quot;</span>);<br>				<span class="hljs-keyword">return</span> thread;<br>			&#125;<br>	&#125;);<br>	producer.setExecutorService(executorService);<br>	producer.setTransactionListener(transactionListener);<br>	producer.start();<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;TransactionTopic&quot;</span>, <span class="hljs-literal">null</span> ,(<span class="hljs-string">&quot;支付&quot;</span>).getBytes(RemotingHelper.DEFAULT_CHARSET);)<br>		<span class="hljs-type">SendResult</span> <span class="hljs-variable">sendResult</span> <span class="hljs-operator">=</span> producer.sendMessageInTransaction(msg,<span class="hljs-literal">null</span>);<br>		<span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">df</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDataFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>		System.out.println(sendResult.getSendStatus()+<span class="hljs-string">&quot;-&quot;</span>+df.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()));<br>	&#125; <span class="hljs-keyword">catch</span> (MQClientException | UnsupportedEncodingException e)&#123;<br>		e.printStatckTrace();	<br>	&#125;<br>	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ; i &lt; <span class="hljs-number">1000</span> ; i ++)&#123;<br>		  Thread.sleep(<span class="hljs-number">1000</span>);<br>		  <br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 消费者</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionConsumer</span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>			<span class="hljs-type">DefaultMQPushConsumer</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQPushConsumer</span>(<span class="hljs-string">&quot;Transaction&quot;</span>);<br>			consumer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>			consumer.subscribe(<span class="hljs-string">&quot;Transaction&quot;</span>,<span class="hljs-string">&quot;*&quot;</span>);<br>			consumer.setMessageModel(<span class="hljs-string">&quot;MessageModel.CLUSTERING&quot;</span>);<br>			consumer.registerMessageListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageListenerConcurrently</span>()&#123;<br>				<span class="hljs-meta">@Override</span><br>				<span class="hljs-keyword">public</span> ConsumeConcurrentlyStatus <span class="hljs-title function_">consumeMessage</span><span class="hljs-params">(List&lt;MessageExt&gt; msgs</span><br><span class="hljs-params">				, ConsumeConcurrentlyContext context)</span>;<br>					<span class="hljs-keyword">try</span>&#123;<br>						<span class="hljs-keyword">for</span>(MessageExt msg : msgs)&#123;<br>							System.out.println(<span class="hljs-string">&quot;update B ... where transactionId&quot;</span> + msg.getTransactionId());<br>							System.out.println(<span class="hljs-string">&quot;commit :&quot;</span> + msg.getTransactionId());<br>							System.out.println(<span class="hljs-string">&quot;执行本地事务成功&quot;</span>);			<br>						&#125; <span class="hljs-keyword">catch</span>(Exception e)&#123;<br>							e.printStackTrace();<br>							System.out.println(<span class="hljs-string">&quot;执行本地事务失败,重试消费,尽量确认B处理成功&quot;</span>);<br>							<span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;						<br>						&#125;<br>						<span class="hljs-keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;<br>					&#125;			<br>			&#125;);<br>			<br>	<br>	&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="队列选择策略"><a href="#队列选择策略" class="headerlink" title="队列选择策略"></a>队列选择策略</h1><p>Topic 创建在多Broker 中</p>
<pre><code class="hljs">  选择队列策略      —由nameserver 提供路由信息
</code></pre>
<p>重试                       — 失败后进行重试</p>
<p>规避策略              — 失败超过最大限值，会规避该broker</p>
<p>故障延迟</p>
<p>记录Broker 发送时长，计算规避时间，选择可用broker</p>
<p>即当 生产者发送时延过久，会设置一个规避时间，规避时间段内不会选择该broker发送消息</p>
<p>默认消息发送规则</p>
<p>轮询</p>
<p>消费者 </p>
<ol>
<li>平均消费  6个队列 3个消费者  每个消费者消费2个队列</li>
<li>轮询 消费者按照顺序获取消息进行消费</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="category-chain-item">中间件</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="print-no-link">#中间件</a>
      
        <a href="/tags/RocketMQ/" class="print-no-link">#RocketMQ</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>RocketMQ</div>
      <div>http://gadoid.io/2025/05/24/RocketMQ/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Codfish</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年5月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/05/24/RocketMQ-%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2/" title="RocketMQ 单机部署">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">RocketMQ 单机部署</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/05/22/RabbitMQ-%E5%AE%BF%E4%B8%BB%E6%9C%BA%E5%AE%89%E8%A3%85/" title="RabbitMQ 宿主机安装">
                        <span class="hidden-mobile">RabbitMQ 宿主机安装</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
      &copy; 2025 - 2025 <a target="_blank" rel="noopener" href="https://github.com/username">CODFISH</a>
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<!-- hexo injector body_end start --><script src="/js/chatbot-loader.js" defer></script><!-- hexo injector body_end end --></body>
</html>
