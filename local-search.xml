<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Shell I</title>
    <link href="/2025/04/09/Shell-1/"/>
    <url>/2025/04/09/Shell-1/</url>
    
    <content type="html"><![CDATA[<h1 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h1><h1 id="ä»€ä¹ˆæ˜¯Shell"><a href="#ä»€ä¹ˆæ˜¯Shell" class="headerlink" title="ä»€ä¹ˆæ˜¯Shell ?"></a>ä»€ä¹ˆæ˜¯Shell ?</h1><p>Shell æ˜¯ä¸€ç§åº”ç”¨äºlinuxç³»ç»Ÿçš„å‘½ä»¤è¡Œè§£é‡Šå™¨å·¥å…·çš„é€šç§°ã€‚ï¼ˆåŠŸèƒ½å®ç°å±‚é¢ï¼‰</p><ul><li>ç”¨æˆ·å‘shell å‘å‡ºå‘½ä»¤æ—¶<ul><li>1 å¦‚æœæ˜¯å†…ç½®å‘½ä»¤ï¼Œåˆ™ç›´æ¥åœ¨å½“å‰è¿›ç¨‹æ‰§è¡Œå†…ç½®å‘½ä»¤ã€‚ï¼ˆå†…ç½®å‘½ä»¤å¦‚cd,echo,å¯ä»¥ä½¿ç”¨typeæŸ¥è¯¢ï¼‰</li><li>2å¦‚æœæ˜¯éå†…ç½®å‘½ä»¤ï¼Œåˆ™fork() ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ã€‚</li></ul></li></ul><p>Shell æ˜¯æ–°ç”¨æˆ·æ¥å…¥æœåŠ¡å™¨åå¯åŠ¨çš„é»˜è®¤æŒ‚èµ·ç¨‹åºã€‚ ï¼ˆåº”ç”¨å±‚é¢ï¼‰</p><ul><li>åº”ç”¨æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå…³é—­è¿›ç¨‹ã€‚ä¸ºäº†ä½¿ç”¨æˆ·å¯ä»¥æ­£å¸¸ä¸æœåŠ¡å™¨äº¤äº’ï¼Œ<ul><li>éœ€è¦ä¸€ä¸ªè¿›ç¨‹åœ¨å‰å°æŒ‚èµ·ï¼ŒæŒç»­ç­‰å¾…ç”¨æˆ·è¾“å…¥å‘½ä»¤</li></ul></li></ul><p>Shell æ˜¯ä½œç”¨äºç”¨æˆ·å’Œæ“ä½œç³»ç»Ÿå†…æ ¸é—´çš„ä¸­é—´ç¨‹åºï¼Œä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œæ‰§è¡Œæ“ä½œç³»ç»ŸåŠŸèƒ½ã€‚ï¼ˆç³»ç»Ÿæ¶æ„å±‚é¢ï¼‰</p><ul><li>è®¸å¤šç¨‹åºéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å®ç°å…¶åŠŸèƒ½ï¼Œè€Œå…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®å†…æ ¸åŠŸèƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥é€šè¿‡shellå‘½ä»¤æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨å®Œæˆç³»ç»Ÿã€‚</li></ul><p><img src="https://i.111666.best/image/P9kPm8BDRhogLaekV6yAYq.png" alt="image"></p><h1 id="Shell-çš„æ‰§è¡Œæ ¼å¼"><a href="#Shell-çš„æ‰§è¡Œæ ¼å¼" class="headerlink" title="Shell çš„æ‰§è¡Œæ ¼å¼"></a>Shell çš„æ‰§è¡Œæ ¼å¼</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">    <span class="hljs-comment">#               command                                - parameter                 value </span><br><br><span class="hljs-comment">#ç³»ç»Ÿæç¤ºç¬¦           shellå‘½ä»¤æˆ–å…¶ä»–å¯æ‰§è¡Œç¨‹åº               é€‰é¡¹                        ä¼ å…¥çš„å‚æ•°</span><br></code></pre></td></tr></table></figure><p>ç‹¬ç«‹çš„å‘½ä»¤çš„å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#  å½“é€šè¿‡ yum , dnf (centos)æˆ–è€… apt(ubuntu) è¿›è¡Œå‘½ä»¤å®‰è£…å</span><br><span class="hljs-comment">#  å¯¹åº”çš„å‘½ä»¤ä¼šæ”¾ç½®åœ¨/user/bin æ–‡ä»¶ç›®å½•ä¸‹ã€‚ shellå‘½ä»¤æ‰§è¡Œæ—¶ä¼šå»è¯¥ç›®å½•ä¸‹å¯»æ‰¾</span><br><span class="hljs-comment">#  å¦‚ [root@iZbp19tqlmjz1dmnm8w43uZ ~]# unzip</span><br><span class="hljs-comment">#  -bash: /usr/bin/unzip: No such file or directory</span><br><span class="hljs-comment">#  æœ‰äº›ç¨‹åºå®‰è£…å å¹¶ä¸ä¼šç›´æ¥å®‰è£…åˆ°/user/bin éœ€è¦åˆ›å»ºè½¯é“¾æ¥ å°†ç¨‹åºæ˜ å°„åˆ°/user/bin ç›®å½•</span><br>   <span class="hljs-built_in">ln</span>             -s            /user/local/bin/xxx   /user/bin/xxx<br><span class="hljs-comment">#  åˆ›å»ºé“¾æ¥      æŒ‡å®šä¸ºè½¯é“¾æ¥    å®‰è£…ç›®å½•               é“¾æ¥</span><br></code></pre></td></tr></table></figure><h1 id="åŸºç¡€å‘½ä»¤"><a href="#åŸºç¡€å‘½ä»¤" class="headerlink" title="åŸºç¡€å‘½ä»¤"></a>åŸºç¡€å‘½ä»¤</h1><h2 id="æ¸…ç©ºå±å¹•æ‰“å°-clear"><a href="#æ¸…ç©ºå±å¹•æ‰“å°-clear" class="headerlink" title="æ¸…ç©ºå±å¹•æ‰“å° - clear"></a>æ¸…ç©ºå±å¹•æ‰“å° - clear</h2><ul><li>åªæ˜¯å°†è¾“å…¥ç½®äºé¡¶ç«¯</li></ul><h2 id="å›æ˜¾æ‰“å°-echo"><a href="#å›æ˜¾æ‰“å°-echo" class="headerlink" title="å›æ˜¾æ‰“å° - echo"></a>å›æ˜¾æ‰“å° - echo</h2><h2 id="æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•-pwd"><a href="#æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½•-pwd" class="headerlink" title="æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½• - pwd"></a>æŸ¥çœ‹å½“å‰å·¥ä½œç›®å½• - pwd</h2><h2 id="æŸ¥çœ‹è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶å-basename"><a href="#æŸ¥çœ‹è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶å-basename" class="headerlink" title="æŸ¥çœ‹è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶å - basename"></a>æŸ¥çœ‹è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶å - basename</h2><ul><li>basename [ path ] [ suffix ]</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ ~]# <span class="hljs-built_in">touch</span> hello.world<br>[root@iZbp19tqlmjz1dmnm8w43uZ ~]# <span class="hljs-built_in">basename</span> /root/hello.world .world<br>hello<br><br></code></pre></td></tr></table></figure><h2 id="æŸ¥è¯¢ç›®å½•ä¸‹çš„å†…å®¹-ls"><a href="#æŸ¥è¯¢ç›®å½•ä¸‹çš„å†…å®¹-ls" class="headerlink" title="æŸ¥è¯¢ç›®å½•ä¸‹çš„å†…å®¹ - ls"></a>æŸ¥è¯¢ç›®å½•ä¸‹çš„å†…å®¹ - ls</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">-l <span class="hljs-comment">#ä»¥é•¿æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯ï¼ˆæƒé™ã€æ‰€æœ‰è€…ã€ç»„ã€å¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰ï¼‰</span><br>-a <span class="hljs-comment">#æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼ˆä»¥ . å¼€å¤´çš„æ–‡ä»¶ï¼‰</span><br>-h <span class="hljs-comment">#ä¸ -l ä¸€èµ·ä½¿ç”¨ï¼Œä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆKBã€MBã€GBï¼‰</span><br>-t <span class="hljs-comment">#æŒ‰ä¿®æ”¹æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰</span><br>-r <span class="hljs-comment">#åå‘æ’åº</span><br>-R <span class="hljs-comment">#é€’å½’åœ°åˆ—å‡ºå­ç›®å½•ä¸­çš„æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><h2 id="ä¿®æ”¹æ–‡ä»¶æƒé™"><a href="#ä¿®æ”¹æ–‡ä»¶æƒé™" class="headerlink" title="ä¿®æ”¹æ–‡ä»¶æƒé™"></a>ä¿®æ”¹æ–‡ä»¶æƒé™</h2><p>linuxä¸­ æ–‡ä»¶çš„ è¯»ï¼Œå†™ï¼Œæ‰§è¡Œæƒé™ è¢«è®¾ç½®ä¸ºäº†3ç§ ï¼š æ‰€æœ‰è€…ï¼Œæ‰€å±ç”¨æˆ·ç»„ï¼Œå…¶ä»–ç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å½“ä½¿ç”¨ls -l æ—¶,å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æƒé™æè¿°</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rw-r--r-- 1 root root 7 Mar 28 00:44 hello.txt<br><br><span class="hljs-comment"># &quot;-&quot; è¡¨ç¤ºæ˜¯ä¸€ä¸ªæ–‡ä»¶ å…¶ä»–ç±»å‹å¦‚ d:ç›®å½•ï¼Œl:é“¾æ¥ï¼Œb:å—è®¾å¤‡ï¼Œc:å­—ç¬¦è®¾å¤‡æ–‡ä»¶</span><br><span class="hljs-comment"># rwx  åˆ†åˆ«ä»£è¡¨r å¯è¯» w å¯å†™ x å¯æ‰§è¡Œ</span><br><span class="hljs-comment"># æ‰€ä»¥ä¸Šè¿° hello.txt æ–‡ä»¶ ä»£è¡¨ å½“å‰æ–‡ä»¶æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œå¯ä»¥è¢«ç”¨æˆ·æ‰€æœ‰è€…è¯»å†™ï¼Œæ‰€å±ç”¨æˆ·ç»„å’Œå…¶ä»–ç”¨æˆ·å¯è¯»</span><br><span class="hljs-comment"># ä½¿ç”¨chmod æ¥ä¿®æ”¹ç”¨æˆ·æƒé™ æƒé™è¡¨ç¤ºä¸ºæ¯”ç‰¹ç½®ä½ã€‚å½“æˆäºˆæ‰€æœ‰æƒé™æ—¶ä¸º 4+2+1 = 7</span><br><span class="hljs-comment"># æ‰€ä»¥ æˆäºˆæ‰€æœ‰è€…æ‰§è¡Œæƒé™ä¸º:</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chmod</span> +100 hello.txt<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwxr--r-- 1 root root 7 Mar 28 00:44 hello.txt<br><span class="hljs-comment"># æˆäºˆå…¶ä»–ç”¨æˆ·è¯»å†™æƒé™ä¸º:</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chmod</span> +006 hello.txt<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwxr--rw- 1 root root 7 Mar 28 00:44 hello.txt<br><span class="hljs-comment"># å»é™¤æ‰€å±ç”¨æˆ·ç»„è¯»æƒé™ä¸º:</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwx---rw- 1 root root 7 Mar 28 00:44 hello.txt<br><br></code></pre></td></tr></table></figure><h2 id="ç”¨æˆ·è®¿é—®æƒé™"><a href="#ç”¨æˆ·è®¿é—®æƒé™" class="headerlink" title="ç”¨æˆ·è®¿é—®æƒé™"></a>ç”¨æˆ·è®¿é—®æƒé™</h2><p>åœ¨æ–‡ä»¶çš„inodeä¸­å­˜å‚¨äº†4å­—èŠ‚çš„æ–‡ä»¶æƒé™å†…å®¹æè¿°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">        -               <br><span class="hljs-comment">#æ–‡ä»¶ç±»å‹(1 å­—èŠ‚ -,d,l,b,c)  #uid gid sticky(3ä½)  rwx rwx rwx    </span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å½“æˆ‘ä»¬æƒ³è¦è®¿é—®æ–‡ä»¶æ—¶</p><ol><li>æŸ¥çœ‹å½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰å½“å‰æ–‡ä»¶çš„è¯»å†™æ‰§è¡Œæƒé™ï¼Œä½¿ç”¨chmod æ·»åŠ å¯¹åº”çš„æƒé™ï¼ˆå½±å“æœ€å°</li><li>ä½¿ç”¨chown ï¼Œ chgrp ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€… ï¼Œæ‰€å±ç»„ æ¥è·å¾—æƒé™</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwx---rw- 1 root root 7 Mar 28 00:44 hello.txt<br><span class="hljs-comment"># å½“å‰æ–‡ä»¶ æ‰€æœ‰è€…å…·æœ‰è¯»å†™æ‰§è¡Œæƒé™ï¼Œå…¶ä»–ç”¨æˆ·å…·æœ‰è¯»å†™æƒé™</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chmod</span> -006 hello.txt<br><span class="hljs-comment"># æ¸…é™¤å…¶ä»–ç”¨æˆ·æƒé™</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# su cod<br><span class="hljs-comment"># åˆ‡æ¢åˆ°å…¶ä»–ç”¨æˆ·ï¼Œç”¨æˆ·æ— æ³•æ‰§è¡Œè¯»å†™</span><br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">cat</span> hello.txt<br><span class="hljs-built_in">cat</span>: hello.txt: Permission denied<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">echo</span> hello &gt;hello.txt<br>bash: hello.txt: Permission denied<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chown</span> cod hello.txt<br><span class="hljs-comment"># åˆ‡æ¢æ–‡ä»¶æ‰€æœ‰è¿™ä¸ºcod, codç”¨æˆ·å¾—åˆ°äº†è¯»å†™æƒé™</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# su cod<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">cat</span> hello.txt<br>ä½ å¥½<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">echo</span> hello &gt; hello.txt<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chmod</span> +070 hello.txt<br><span class="hljs-comment"># å‘æ–‡ä»¶æ·»åŠ æ‰€å±ç»„çš„è®¿é—®æƒé™</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwxrwx--- 1 root root 6 Apr  9 17:45 hello.txt<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chgrp</span> cod hello.txt<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chown</span> root hello.txt<br><span class="hljs-comment"># ä¿®æ”¹æ‰€å±ç»„ä¸ºcod,æ‰€æœ‰è€…ä¸ºroot,ä½¿ç”¨æ‰€å±ç»„è®¿é—®</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwxrwx--- 1 root cod 6 Apr  9 17:45 hello.txt<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# su cod<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">cat</span> hello.txt<br>hello<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">echo</span> ä½ å¥½ &gt;hello.txt<br>[cod@iZbp19tqlmjz1dmnm8w43uZ hello]$ <span class="hljs-built_in">cat</span> hello.txt<br>ä½ å¥½<br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">chmod</span>+7777 hello.txt<br><span class="hljs-comment"># ä¿®æ”¹æ‰€æœ‰ç½®ä½ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰è€…å’Œæ‰€å±ç»„å˜ä¸ºs</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">ls</span> -l<br>total 4<br>-rwsrwsrwt 1 root cod 7 Apr  9 18:07 hello.txt<br><br></code></pre></td></tr></table></figure><h2 id="åˆ‡æ¢ç›®å½•-cd"><a href="#åˆ‡æ¢ç›®å½•-cd" class="headerlink" title="åˆ‡æ¢ç›®å½• - cd"></a>åˆ‡æ¢ç›®å½• - cd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ codfish]# <span class="hljs-built_in">cd</span> hello/<br><span class="hljs-comment"># ç§»åŠ¨åˆ°helloç›®å½•</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ hello]# <span class="hljs-built_in">cd</span> ..<br><span class="hljs-comment"># è¿”å›ä¸Šçº§ç›®å½•</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ codfish]# <span class="hljs-built_in">cd</span> ~<br><span class="hljs-comment"># è¿”å›homeç›®å½•</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ ~]#<br><br></code></pre></td></tr></table></figure><h2 id="æ‹·è´æ–‡ä»¶æˆ–ç›®å½•-cp"><a href="#æ‹·è´æ–‡ä»¶æˆ–ç›®å½•-cp" class="headerlink" title="æ‹·è´æ–‡ä»¶æˆ–ç›®å½• - cp"></a>æ‹·è´æ–‡ä»¶æˆ–ç›®å½• - cp</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">cp</span> hello hello2<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">ls</span><br>hello  hello2<br><br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºæ–‡ä»¶ç›®å½•-mkdir"><a href="#åˆ›å»ºæ–‡ä»¶ç›®å½•-mkdir" class="headerlink" title="åˆ›å»ºæ–‡ä»¶ç›®å½• - mkdir"></a>åˆ›å»ºæ–‡ä»¶ç›®å½• - mkdir</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">mkdir</span> hi<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">mkdir</span> -p one/two<br><span class="hljs-comment"># é€’å½’åˆ›å»º</span><br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">cd</span> one/two/<br>[root@iZbp19tqlmjz1dmnm8w43uZ two]#<br><br></code></pre></td></tr></table></figure><h2 id="ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•-mv"><a href="#ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•-mv" class="headerlink" title="ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•  - mv"></a>ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•  - mv</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">ls</span><br>hello2  hello<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">mv</span> hello hi<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">ls</span><br>hello2  hi<br><br></code></pre></td></tr></table></figure><h2 id="åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•-rm"><a href="#åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•-rm" class="headerlink" title="åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• - rm"></a>åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• - rm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">rm</span> hi<br><span class="hljs-built_in">rm</span>: remove regular empty file <span class="hljs-string">&#x27;hi&#x27;</span>? y<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">mkdir</span> hi<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">rm</span> -r hi<br><span class="hljs-built_in">rm</span>: remove directory <span class="hljs-string">&#x27;hi&#x27;</span>? y<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">rm</span> -rf hi<br><span class="hljs-comment"># é€’å½’åˆ é™¤ç›®å½•åŠæ–‡ä»¶</span><br><br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºç©ºæ–‡ä»¶-touch"><a href="#åˆ›å»ºç©ºæ–‡ä»¶-touch" class="headerlink" title="åˆ›å»ºç©ºæ–‡ä»¶ - touch"></a>åˆ›å»ºç©ºæ–‡ä»¶ - touch</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">touch</span> file<br>[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">ls</span><br>file<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ–‡ä»¶å†…å®¹"><a href="#æŸ¥çœ‹æ–‡ä»¶å†…å®¹" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶å†…å®¹"></a>æŸ¥çœ‹æ–‡ä»¶å†…å®¹</h2><p>cat  ç›´æ¥æŸ¥çœ‹æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">cat</span> file<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br></code></pre></td></tr></table></figure><p>more  äº¤äº’å¼æŸ¥çœ‹æ–‡ä»¶å†…å®¹</p><p>less </p><p>head  ä»å¤´éƒ¨æŸ¥çœ‹æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">head</span> -n 3 file<br>1<br>2<br>3<br><br></code></pre></td></tr></table></figure><p>tail ä»å°¾éƒ¨æŸ¥çœ‹æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">tail</span> -n 3 file<br>8<br>9<br>10<br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ–‡ä»¶-ç›®å½•-å®é™…ä¿¡æ¯-ï¼ˆinode-block-åœ°å€ï¼‰-stat"><a href="#æŸ¥çœ‹æ–‡ä»¶-ç›®å½•-å®é™…ä¿¡æ¯-ï¼ˆinode-block-åœ°å€ï¼‰-stat" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶&#x2F;ç›®å½• å®é™…ä¿¡æ¯ ï¼ˆinode&#x2F;block åœ°å€ï¼‰- stat"></a>æŸ¥çœ‹æ–‡ä»¶&#x2F;ç›®å½• å®é™…ä¿¡æ¯ ï¼ˆinode&#x2F;block åœ°å€ï¼‰- stat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ cod]# <span class="hljs-built_in">stat</span> file<br>  File: file<br>  Size: 21              Blocks: 8          IO Block: 4096   regular file<br>Device: fd03h/64771d    Inode: 1224103     Links: 1<br>Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)<br>Access: 2025-04-09 21:05:51.065782226 +0800<br>Modify: 2025-04-09 21:05:49.079699125 +0800<br>Change: 2025-04-09 21:05:49.081699209 +0800<br> Birth: 2025-04-09 21:05:49.079699125 +0800<br><br></code></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯-file"><a href="#æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯-file" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ - file"></a>æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ - file</h2><h2 id="å‹ç¼©-è§£å‹ç¼©-tar-czf-xzf"><a href="#å‹ç¼©-è§£å‹ç¼©-tar-czf-xzf" class="headerlink" title="å‹ç¼©&#x2F;è§£å‹ç¼©  - tar(czf&#x2F;xzf)"></a>å‹ç¼©&#x2F;è§£å‹ç¼©  - tar(czf&#x2F;xzf)</h2>]]></content>
    
    
    <categories>
      
      <category>Shell</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨ç½‘ç»œ</title>
    <link href="/2025/04/06/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C/"/>
    <url>/2025/04/06/%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h1><h2 id="Veth"><a href="#Veth" class="headerlink" title="Veth"></a>Veth</h2><p>vethï¼ˆVirtual Ethernetï¼‰æ˜¯Linuxä¸­çš„ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå®ƒå·¥ä½œåœ¨ç¬¬äºŒå±‚ï¼ˆæ•°æ®é“¾è·¯å±‚ï¼‰ï¼Œä¸»è¦ç”¨äºè¿æ¥ä¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ï¼ˆnetwork namespacesï¼‰ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>vethè®¾å¤‡æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œç±»ä¼¼äºä¸€æ ¹ç½‘çº¿çš„ä¸¤ç«¯ã€‚å½“æ•°æ®åŒ…ä»ä¸€ç«¯å‘å‡ºåï¼Œä¼šç«‹å³ä»å¦ä¸€ç«¯æ”¶åˆ°ã€‚è¿™ç§ç‰¹æ€§ä½¿å®ƒæˆä¸ºè¿æ¥ä¸åŒç½‘ç»œå‘½åç©ºé—´çš„ç†æƒ³å·¥å…·ã€‚</p><h3 id="ä¸»è¦ç‰¹ç‚¹"><a href="#ä¸»è¦ç‰¹ç‚¹" class="headerlink" title="ä¸»è¦ç‰¹ç‚¹"></a>ä¸»è¦ç‰¹ç‚¹</h3><ol><li><strong>æˆå¯¹åˆ›å»º</strong>ï¼švethè®¾å¤‡å¿…é¡»æˆå¯¹åˆ›å»ºï¼Œä¸€ç«¯å‘é€çš„æ•°æ®ä¼šä»å¦ä¸€ç«¯æ¥æ”¶ã€‚</li><li><strong>è·¨å‘½åç©ºé—´é€šä¿¡</strong>ï¼švethå¯¹çš„ä¸¤ç«¯å¯ä»¥ä½äºä¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ä¸­ï¼Œæ˜¯Linuxå®ç°ç½‘ç»œè™šæ‹ŸåŒ–çš„åŸºç¡€è®¾æ–½ã€‚</li><li><strong>æ— çŠ¶æ€</strong>ï¼švethè®¾å¤‡æœ¬èº«ä¸å­˜å‚¨ä»»ä½•çŠ¶æ€ä¿¡æ¯ï¼Œä»…ä½œä¸ºæ•°æ®çš„ä¼ è¾“é€šé“ã€‚</li><li><strong>æ”¯æŒæ ‡å‡†ç½‘ç»œæ“ä½œ</strong>ï¼šå¯ä»¥ä¸ºvethè®¾å¤‡é…ç½®IPåœ°å€ã€æ·»åŠ è·¯ç”±ã€è®¾ç½®é˜²ç«å¢™è§„åˆ™ç­‰ã€‚</li></ol><h3 id="Vethå·¥ä½œæ¨¡å¼"><a href="#Vethå·¥ä½œæ¨¡å¼" class="headerlink" title="Vethå·¥ä½œæ¨¡å¼"></a>Vethå·¥ä½œæ¨¡å¼</h3><p><img src="https://i.111666.best/image/cd1vfax0o2HRKQWO1OAGwY.png" alt="image"></p><p>veth çš„å®¿ä¸»ç«¯æ¥å£ï¼Œåœ¨æœªæ¥å…¥ bridge ä¸”é…ç½® IP æ—¶ï¼Œå¯ç±»æ¯”ä¸º VLAN å­ç½‘çš„é»˜è®¤ç½‘å…³ï¼›</p><p>è€Œå½“åŠ å…¥ bridge æ—¶ï¼Œå®ƒå°±é€€åŒ–æˆçº¯äºŒå±‚æ¥å…¥å£ï¼Œæˆä¸º bridge å†…éƒ¨ä»¥å¤ªå¸§è½¬å‘çš„ç«¯å£ï¼Œä¸åº”å†æ‰¿æ‹… IP å±‚é€šä¿¡è§’è‰²ã€‚</p><h3 id="Vethè®¾å¤‡ç«¯é…ç½®"><a href="#Vethè®¾å¤‡ç«¯é…ç½®" class="headerlink" title="Vethè®¾å¤‡ç«¯é…ç½®"></a>Vethè®¾å¤‡ç«¯é…ç½®</h3><p>å®¿ä¸»æœºé…ç½®ç½‘ç»œâ†’åˆ›å»ºå®¹å™¨â†’å°†ç½‘ç»œåŠ å…¥å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å®¿ä¸»æœº </span><br><span class="hljs-built_in">sudo</span> ip <span class="hljs-built_in">link</span> add veth-c <span class="hljs-built_in">type</span> veth peer name veth-br  <span class="hljs-comment"># é…ç½®ç»“ä¼´ç½‘ç»œ</span><br><span class="hljs-built_in">sudo</span> ip addr add  192.168.100.100/24  dev  veth-br <span class="hljs-comment">#é…ç½®ip ä¿¡æ¯</span><br><span class="hljs-built_in">sudo</span> ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-br up<br><br><span class="hljs-comment">#åˆ›å»ºå®¹å™¨åï¼Œåœ¨å®¿ä¸»æœºæŸ¥è¯¢å®¹å™¨è¿›ç¨‹ï¼Œæ·»åŠ ç½‘ç»œåˆ°å®¿ä¸»æœº</span><br><span class="hljs-built_in">sudo</span> ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-c netns 968998<br><br><span class="hljs-comment">#å®¹å™¨</span><br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-c up<br>ip addr add 192.168.100.100/24 dev veth-c<br></code></pre></td></tr></table></figure><p>åˆ›å»ºç½‘ç»œå‘½åç©ºé—´â†’åˆ›å»ºvethç½‘ç»œâ†’æ·»åŠ vethç½‘ç»œåˆ°ç½‘ç»œå‘½åç©ºç©ºé—´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®¿ä¸»æœºæ·»åŠ ç½‘ç»œå‘½åç©ºé—´ net1</span><br>ip netns add net1<br><span class="hljs-comment"># æ·»åŠ veth ç½‘ç»œ</span><br>ip <span class="hljs-built_in">link</span> add veth1 <span class="hljs-built_in">type</span> veth peer name veth1_p<br><span class="hljs-comment"># ç»‘å®švethç½‘ç»œåˆ°ç½‘ç»œå‘½åç©ºé—´ net1</span><br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth1 netns net1<br>ip addr add 192.168.100.100/24 dev veth1_p<br><br><span class="hljs-comment">#é€šè¿‡å‘½ä»¤æ‰§è¡Œ</span><br>ip netns <span class="hljs-built_in">exec</span> net1 ip addr<br>ip netns <span class="hljs-built_in">exec</span> net1 ip addr add 192.168.100.102/24 dev veth1<br>ip netns <span class="hljs-built_in">exec</span> net1 ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth1 up<br></code></pre></td></tr></table></figure><p>ç½‘æ¡¥é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®¿ä¸»æœº åˆ›å»º namespace</span><br>ip netns add ns1<br>ip netns add ns2<br><br><span class="hljs-comment"># åˆ›å»º veth pair</span><br>ip <span class="hljs-built_in">link</span> add veth-a <span class="hljs-built_in">type</span> veth peer name veth-a-ns<br>ip <span class="hljs-built_in">link</span> add veth-b <span class="hljs-built_in">type</span> veth peer name veth-b-ns<br><br><span class="hljs-comment"># æ”¾è¿› namespace</span><br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-a-ns netns ns1<br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-b-ns netns ns2<br><br><span class="hljs-comment"># è®¾ç½® IP</span><br>ip netns <span class="hljs-built_in">exec</span> ns1 ip addr add 192.168.100.10/24 dev veth-a-ns<br>ip netns <span class="hljs-built_in">exec</span> ns2 ip addr add 192.168.100.20/24 dev veth-b-ns<br><br><span class="hljs-comment"># å¯åŠ¨æ¥å£</span><br>ip netns <span class="hljs-built_in">exec</span> ns1 ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-a-ns up<br>ip netns <span class="hljs-built_in">exec</span> ns2 ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-b-ns up<br>ip netns <span class="hljs-built_in">exec</span> ns1 ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> lo up<br>ip netns <span class="hljs-built_in">exec</span> ns2 ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> lo up<br><br><span class="hljs-comment"># å®¿ä¸»æœºæ¥å£ up</span><br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-a up<br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-b up<br><br><span class="hljs-comment"># åˆ›å»º bridge</span><br>ip <span class="hljs-built_in">link</span> add br0 <span class="hljs-built_in">type</span> bridge<br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> br0 up<br>ip addr add 192.168.100.1/24 dev br0<br><br><span class="hljs-comment"># åŠ å…¥ bridge</span><br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-a master br0<br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> veth-b master br0<br><br>ip netns <span class="hljs-built_in">exec</span> ns1 ping -c 3 192.168.100.20<br>ip netns <span class="hljs-built_in">exec</span> ns1 ping -c 3 192.168.100.1<br><br></code></pre></td></tr></table></figure><h2 id="å®¹å™¨å¤–éƒ¨ç½‘ç»œè®¿é—®"><a href="#å®¹å™¨å¤–éƒ¨ç½‘ç»œè®¿é—®" class="headerlink" title="å®¹å™¨å¤–éƒ¨ç½‘ç»œè®¿é—®"></a>å®¹å™¨å¤–éƒ¨ç½‘ç»œè®¿é—®</h2><p>è®¾ç½®ç½‘ç»œè½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> iptables -A FORWARD -j ACCEPT<br>ç½®ä½  /proc/sys/net/ipv4/ip_forward<br></code></pre></td></tr></table></figure><p>Docker é€šè¿‡å‘iptableså†™å…¥è§„åˆ™ æ¥æ§åˆ¶ ç«¯å£æ˜ å°„è½¬å‘</p><h3 id="NATï¼ˆnetwork-address-translationï¼‰"><a href="#NATï¼ˆnetwork-address-translationï¼‰" class="headerlink" title="NATï¼ˆnetwork address translationï¼‰"></a>NATï¼ˆnetwork address translationï¼‰</h3><p>NAT (Network Address Translation) æ˜¯ä¸€ç§ç½‘ç»œæŠ€æœ¯ï¼Œå®ƒå…è®¸å¤šå°è®¾å¤‡é€šè¿‡å•ä¸ªå…¬å…± IP åœ°å€è®¿é—®äº’è”ç½‘ã€‚é€šè¿‡ä¸€å¼ æ˜ å°„è¡¨å®Œæˆå†…ç½‘å’Œå¤–ç½‘IPï¼Œç«¯å£é—´çš„è½¬æ¢</p><p>NAT çš„ä¸»è¦åŠŸèƒ½å’Œç‰¹ç‚¹ï¼š</p><ol><li>åœ°å€è½¬æ¢ï¼šNAT å°†å†…éƒ¨ç½‘ç»œä¸­çš„ç§æœ‰ IP åœ°å€è½¬æ¢ä¸ºå…¬å…± IP åœ°å€ï¼Œä½¿å¾—å†…éƒ¨ç½‘ç»œçš„è®¾å¤‡èƒ½å¤Ÿè®¿é—®äº’è”ç½‘</li><li>èŠ‚çº¦ IP åœ°å€èµ„æºï¼šç”±äº IPv4 åœ°å€èµ„æºæœ‰é™ï¼ŒNAT æŠ€æœ¯å¯ä»¥ä½¿å¤šå°è®¾å¤‡å…±äº«ä¸€ä¸ªå…¬å…± IP åœ°å€ï¼Œç¼“è§£äº† IP åœ°å€çŸ­ç¼ºé—®é¢˜</li><li>éšè—å†…éƒ¨ç½‘ç»œç»“æ„ï¼šNAT å¯ä»¥éšè—å†…éƒ¨ç½‘ç»œçš„çœŸå® IP åœ°å€ï¼Œæé«˜ç½‘ç»œå®‰å…¨æ€§</li></ol><p>NAT çš„ä¸»è¦ç±»å‹ï¼š</p><ol><li>é™æ€ NATï¼šä¸€å¯¹ä¸€æ˜ å°„ï¼Œæ¯ä¸ªç§æœ‰ IP åœ°å€å¯¹åº”ä¸€ä¸ªå›ºå®šçš„å…¬å…± IP åœ°å€</li><li>åŠ¨æ€ NATï¼šä»å…¬å…± IP åœ°å€æ± ä¸­åŠ¨æ€åˆ†é…åœ°å€</li><li>ç½‘ç»œåœ°å€ç«¯å£è½¬æ¢ï¼ˆNAPT&#x2F;PATï¼‰ï¼šæœ€å¸¸ç”¨çš„ç±»å‹ï¼Œå¤šä¸ªç§æœ‰ IP åœ°å€å…±äº«ä¸€ä¸ªå…¬å…± IP åœ°å€ï¼Œé€šè¿‡ä¸åŒçš„ç«¯å£å·åŒºåˆ†ä¸åŒçš„è¿æ¥</li></ol><h3 id="1-filterè¡¨"><a href="#1-filterè¡¨" class="headerlink" title="1.filterè¡¨"></a>1.filterè¡¨</h3><p>filteråŒ…å«3ä¸ªå†…ç½®é“¾ç”¨äºè¿‡æ»¤æ•°æ®åŒ…ï¼ŒåŒ…å«ä¸‰ä¸ªå†…ç½®é“¾ï¼š</p><ul><li>INPUTï¼šå¤„ç†å‘å¾€æœ¬æœºçš„æ•°æ®åŒ…</li><li>FORWARDï¼šå¤„ç†ç»è¿‡æœ¬æœºè½¬å‘çš„æ•°æ®åŒ…</li><li>OUTPUTï¼šå¤„ç†æœ¬æœºå‘å‡ºçš„æ•°æ®åŒ…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…è®¸å·²å»ºç«‹çš„è¿æ¥</span><br>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br><span class="hljs-comment"># å…è®¸æœ¬åœ°å›ç¯æ¥å£</span><br>iptables -A INPUT -i lo -j ACCEPT<br><span class="hljs-comment"># å…è®¸ SSH è¿æ¥</span><br>iptables -A INPUT -p tcp --dport 22 -j ACCEPT<br><span class="hljs-comment"># é»˜è®¤æ‹’ç»å…¶ä»–æ‰€æœ‰å…¥ç«™è¿æ¥</span><br>iptables -P INPUT DROP<br><span class="hljs-comment"># æŸ¥è¯¢è¡¨ç»“æ„</span><br>iptables -L -v<br><span class="hljs-comment"># æŒ‡å®šfilterè¡¨æŸ¥è¯¢</span><br>iptables -t filter -L -v<br></code></pre></td></tr></table></figure><h3 id="2-nat-è¡¨"><a href="#2-nat-è¡¨" class="headerlink" title="2. nat è¡¨"></a>2. nat è¡¨</h3><p>nat è¡¨ç”¨äºç½‘ç»œåœ°å€è½¬æ¢ï¼ŒåŒ…å«ä¸‰ä¸ªå†…ç½®é“¾ï¼š</p><ul><li>PREROUTINGï¼šåœ¨è·¯ç”±å†³ç­–å‰å¤„ç†æ•°æ®åŒ…</li><li>OUTPUTï¼šå¤„ç†æœ¬æœºäº§ç”Ÿçš„æ•°æ®åŒ…</li><li>POSTROUTINGï¼šåœ¨è·¯ç”±å†³ç­–åå¤„ç†æ•°æ®åŒ…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å°†å†…ç½‘ä¸»æœºçš„æµé‡ NAT åˆ°å…¬ç½‘ IP</span><br>iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE<br><span class="hljs-comment"># ç«¯å£è½¬å‘</span><br>iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080<br><span class="hljs-comment"># æŸ¥è¯¢natè¡¨</span><br>iptables -t nat -L -v<br></code></pre></td></tr></table></figure><h3 id="3-mangle-è¡¨"><a href="#3-mangle-è¡¨" class="headerlink" title="3. mangle è¡¨"></a>3. mangle è¡¨</h3><p>mangle è¡¨ç”¨äºç‰¹æ®Šçš„æ•°æ®åŒ…ä¿®æ”¹ï¼ŒåŒ…å«äº”ä¸ªå†…ç½®é“¾ï¼š</p><ul><li>PREROUTINGï¼šæ•°æ®åŒ…è¿›å…¥ç³»ç»Ÿæ—¶</li><li>INPUTï¼šæ•°æ®åŒ…è¢«è·¯ç”±åˆ°æœ¬åœ°æ—¶</li><li>FORWARDï¼šè½¬å‘æ•°æ®åŒ…æ—¶</li><li>OUTPUTï¼šæœ¬åœ°ç”Ÿæˆçš„æ•°æ®åŒ…æ—¶</li><li>POSTROUTINGï¼šæ•°æ®åŒ…ç¦»å¼€ç³»ç»Ÿæ—¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä¿®æ”¹æ•°æ®åŒ…çš„ TTL å€¼</span><br>iptables -t mangle -A POSTROUTING -o eth0 -j TTL --ttl-set 64<br><span class="hljs-comment"># è®¾ç½®æ•°æ®åŒ…çš„ä¼˜å…ˆçº§</span><br>iptables -t mangle -A PREROUTING -p tcp --dport 22 -j TOS --set-tos 0x10<br><span class="hljs-comment"># æŸ¥è¯¢mangleè¡¨</span><br>iptables -t mangle -L -v<br></code></pre></td></tr></table></figure><h3 id="4-raw-è¡¨"><a href="#4-raw-è¡¨" class="headerlink" title="4. raw è¡¨"></a>4. raw è¡¨</h3><p>raw è¡¨ç”¨äºé…ç½®å…äºè¿æ¥è·Ÿè¸ªçš„ä¾‹å¤–ï¼ŒåŒ…å«ä¸¤ä¸ªå†…ç½®é“¾ï¼š</p><ul><li>PREROUTINGï¼šå¤„ç†åˆšåˆ°è¾¾çš„æ•°æ®åŒ…</li><li>OUTPUTï¼šå¤„ç†æœ¬åœ°ç”Ÿæˆçš„æ•°æ®åŒ…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¹ DNS æŸ¥è¯¢å…é™¤è¿æ¥è·Ÿè¸ª</span><br>iptables -t raw -A OUTPUT -p udp --dport 53 -j NOTRACK<br><span class="hljs-comment"># å¯¹æŸäº› IP å…é™¤è¿æ¥è·Ÿè¸ª</span><br>iptables -t raw -A PREROUTING -s 192.168.1.100 -j NOTRACK<br><span class="hljs-comment"># æŸ¥è¯¢rawè¡¨</span><br>iptables -t raw -L -v<br></code></pre></td></tr></table></figure><h3 id="5-security-è¡¨"><a href="#5-security-è¡¨" class="headerlink" title="5. security è¡¨"></a>5. security è¡¨</h3><p>security è¡¨ç”¨äºå¼ºåˆ¶è®¿é—®æ§åˆ¶ç½‘ç»œè§„åˆ™ï¼ˆå¦‚ SELinuxï¼‰ï¼ŒåŒ…å«ä¸‰ä¸ªå†…ç½®é“¾ï¼š</p><ul><li>INPUTï¼šå¤„ç†å…¥ç«™æ•°æ®åŒ…</li><li>OUTPUTï¼šå¤„ç†å‡ºç«™æ•°æ®åŒ…</li><li>FORWARDï¼šå¤„ç†è½¬å‘æ•°æ®åŒ…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è®¾ç½® SELinux å®‰å…¨ä¸Šä¸‹æ–‡æ ‡è®°</span><br>iptables -t security -A INPUT -p tcp --dport 80 -j SECMARK --selctx system_u:object_r:http_server_packet_t:s0<br><span class="hljs-comment"># æŸ¥è¯¢securityè¡¨</span><br>iptables -t security -L -v<br></code></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¤–éƒ¨ç½‘ç»œ - å®¿ä¸»æœº - å®¹å™¨ ï¼š</p><p>åˆ›å»º vethç½‘ç»œï¼Œå°†vethç½‘ç»œä¸¤ç«¯ç»‘å®šåœ¨å®¿ä¸»æœºå’Œå®¹å™¨ä¸¤ç«¯</p><p>é…ç½®ç½‘æ¡¥ï¼Œå°†å®¿ä¸»æœºä¸­çš„vethç«¯åŠ å…¥åˆ°ç½‘æ¡¥ä¸­ï¼Œvethè‡ªåŠ¨é€€åŒ–ä¸ºè™šæ‹Ÿç«¯å£</p><p>å®¿ä¸»æœºä½¿ç”¨iptables é…ç½® æ”¶å‘è¯·æ±‚çš„ç½‘ç»œæ•°æ®æµé‡ æ˜ å°„åˆ°å®¹å™¨ç½‘ç»œã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>è™šæ‹ŸåŒ–æŠ€æœ¯</tag>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>task-struct</title>
    <link href="/2025/04/01/task-struct/"/>
    <url>/2025/04/01/task-struct/</url>
    
    <content type="html"><![CDATA[<h1 id="Linux-å†…æ ¸ä¸­çš„-task-struct-ç»“æ„è¯¦è§£"><a href="#Linux-å†…æ ¸ä¸­çš„-task-struct-ç»“æ„è¯¦è§£" class="headerlink" title="Linux å†…æ ¸ä¸­çš„ task_struct ç»“æ„è¯¦è§£"></a>Linux å†…æ ¸ä¸­çš„ <code>task_struct</code> ç»“æ„è¯¦è§£</h1><p>task_struct æ˜¯ Linux å†…æ ¸ä¸­ç”¨æ¥è¡¨ç¤º <strong>è¿›ç¨‹ï¼ˆæˆ–è€…çº¿ç¨‹ï¼‰</strong> çš„æ ¸å¿ƒç»“æ„ä½“ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦ã€ç®¡ç†å’Œè¿½è¸ªè¿›ç¨‹çš„åŸºç¡€ã€‚è¯¥ç»“æ„ä½“éå¸¸åºå¤§ï¼ŒåŒ…å«äº†å¤§é‡å­—æ®µï¼Œç”¨äºç®¡ç†è¿›ç¨‹çš„å„ç§çŠ¶æ€ã€‚</p><hr><h2 id="ğŸ§ -task-struct-çš„ä¸»è¦ç»„æˆç»“æ„ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰"><a href="#ğŸ§ -task-struct-çš„ä¸»è¦ç»„æˆç»“æ„ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰" class="headerlink" title="ğŸ§  task_struct çš„ä¸»è¦ç»„æˆç»“æ„ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰"></a>ğŸ§  <code>task_struct</code> çš„ä¸»è¦ç»„æˆç»“æ„ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç±»ï¼‰</h2><h3 id="1-è¿›ç¨‹æ ‡è¯†"><a href="#1-è¿›ç¨‹æ ‡è¯†" class="headerlink" title="1. è¿›ç¨‹æ ‡è¯†"></a>1. è¿›ç¨‹æ ‡è¯†</h3><p>ç”¨äºæ ‡è¯†è¿›ç¨‹çš„å”¯ä¸€æ€§ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">pid_t</span> pid;                      <span class="hljs-comment">// è¿›ç¨‹ID</span><br><span class="hljs-type">pid_t</span> tgid;                     <span class="hljs-comment">// çº¿ç¨‹ç»„IDï¼ˆä¸»çº¿ç¨‹çš„pidï¼‰</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> *<span class="hljs-title">thread_pid</span>;</span>        <span class="hljs-comment">// çº¿ç¨‹IDï¼ˆæ¯ä¸ªçº¿ç¨‹å”¯ä¸€ï¼‰</span><br></code></pre></td></tr></table></figure><hr><h3 id="2-è¿›ç¨‹çŠ¶æ€ä¸è°ƒåº¦ç›¸å…³"><a href="#2-è¿›ç¨‹çŠ¶æ€ä¸è°ƒåº¦ç›¸å…³" class="headerlink" title="2. è¿›ç¨‹çŠ¶æ€ä¸è°ƒåº¦ç›¸å…³"></a>2. è¿›ç¨‹çŠ¶æ€ä¸è°ƒåº¦ç›¸å…³</h3><p>åŒ…æ‹¬è¿›ç¨‹çŠ¶æ€ã€ä¼˜å…ˆçº§ã€è°ƒåº¦å™¨ç­–ç•¥ç­‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> state;           <span class="hljs-comment">// å½“å‰è¿›ç¨‹çŠ¶æ€ï¼ˆå¦‚ TASK_RUNNING ç­‰ï¼‰</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags;            <span class="hljs-comment">// æ ‡å¿—ä½ï¼ˆPF_å¼€å¤´ï¼‰</span><br><span class="hljs-type">int</span> prio;                      <span class="hljs-comment">// åŠ¨æ€ä¼˜å…ˆçº§</span><br><span class="hljs-type">int</span> static_prio;               <span class="hljs-comment">// é™æ€ä¼˜å…ˆçº§</span><br><span class="hljs-type">int</span> policy;                    <span class="hljs-comment">// è°ƒåº¦ç­–ç•¥ï¼ˆå¦‚ SCHED_NORMALï¼‰</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sched_entity</span> <span class="hljs-title">se</span>;</span>        <span class="hljs-comment">// CFSè°ƒåº¦å®ä½“</span><br></code></pre></td></tr></table></figure><hr><h3 id="3-çˆ¶å­è¿›ç¨‹å…³ç³»"><a href="#3-çˆ¶å­è¿›ç¨‹å…³ç³»" class="headerlink" title="3. çˆ¶å­è¿›ç¨‹å…³ç³»"></a>3. çˆ¶å­è¿›ç¨‹å…³ç³»</h3><p>è®°å½•è¿›ç¨‹ä¹‹é—´çš„å±‚çº§å…³ç³»ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> *<span class="hljs-title">real_parent</span>;</span>   <span class="hljs-comment">// åˆ›å»ºå®ƒçš„è¿›ç¨‹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> *<span class="hljs-title">parent</span>;</span>        <span class="hljs-comment">// å½“å‰çˆ¶è¿›ç¨‹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">children</span>;</span>         <span class="hljs-comment">// å­è¿›ç¨‹é“¾è¡¨</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">sibling</span>;</span>          <span class="hljs-comment">// å…„å¼Ÿè¿›ç¨‹é“¾è¡¨</span><br></code></pre></td></tr></table></figure><hr><h3 id="4-å†…å­˜ç®¡ç†"><a href="#4-å†…å­˜ç®¡ç†" class="headerlink" title="4. å†…å­˜ç®¡ç†"></a>4. å†…å­˜ç®¡ç†</h3><p>ä¸åœ°å€ç©ºé—´å’Œè™šæ‹Ÿå†…å­˜ç›¸å…³çš„ä¿¡æ¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span>;</span>             <span class="hljs-comment">// è¿›ç¨‹çš„å†…å­˜æè¿°ç¬¦ï¼ˆç”¨æˆ·æ€ï¼‰</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">active_mm</span>;</span>      <span class="hljs-comment">// å½“å‰æ´»è·ƒçš„ mmï¼ˆå†…æ ¸çº¿ç¨‹ä¹Ÿä¼šè®¾ç½®ï¼‰</span><br></code></pre></td></tr></table></figure><hr><h3 id="5-æ–‡ä»¶ç³»ç»Ÿä¸æ–‡ä»¶æè¿°ç¬¦è¡¨"><a href="#5-æ–‡ä»¶ç³»ç»Ÿä¸æ–‡ä»¶æè¿°ç¬¦è¡¨" class="headerlink" title="5. æ–‡ä»¶ç³»ç»Ÿä¸æ–‡ä»¶æè¿°ç¬¦è¡¨"></a>5. æ–‡ä»¶ç³»ç»Ÿä¸æ–‡ä»¶æè¿°ç¬¦è¡¨</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">fs_struct</span> *<span class="hljs-title">fs</span>;</span>             <span class="hljs-comment">// æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼ˆå½“å‰ç›®å½•ç­‰ï¼‰</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">files_struct</span> *<span class="hljs-title">files</span>;</span>       <span class="hljs-comment">// æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</span><br></code></pre></td></tr></table></figure><hr><h3 id="6-ä¿¡å·å¤„ç†"><a href="#6-ä¿¡å·å¤„ç†" class="headerlink" title="6. ä¿¡å·å¤„ç†"></a>6. ä¿¡å·å¤„ç†</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">signal_struct</span> *<span class="hljs-title">signal</span>;</span>     <span class="hljs-comment">// æ‰€å±çº¿ç¨‹ç»„çš„ä¿¡å·å¤„ç†ç»“æ„</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sighand_struct</span> *<span class="hljs-title">sighand</span>;</span>   <span class="hljs-comment">// ä¿¡å·å¤„ç†å‡½æ•°</span><br><span class="hljs-type">sigset_t</span> blocked;                 <span class="hljs-comment">// å½“å‰å±è”½çš„ä¿¡å·</span><br></code></pre></td></tr></table></figure><hr><h3 id="7-å‘½åç©ºé—´ï¼ˆNamespaceï¼‰"><a href="#7-å‘½åç©ºé—´ï¼ˆNamespaceï¼‰" class="headerlink" title="7. å‘½åç©ºé—´ï¼ˆNamespaceï¼‰"></a>7. å‘½åç©ºé—´ï¼ˆNamespaceï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nsproxy</span> *<span class="hljs-title">nsproxy</span>;</span>          <span class="hljs-comment">// å„ç±»å‘½åç©ºé—´çš„ç»Ÿä¸€æ¥å£</span><br></code></pre></td></tr></table></figure><hr><h3 id="8-CPU-å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸å…³"><a href="#8-CPU-å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸å…³" class="headerlink" title="8. CPU å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸å…³"></a>8. CPU å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸å…³</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">thread_struct</span> <span class="hljs-title">thread</span>;</span>      <span class="hljs-comment">// å­˜å‚¨CPUå¯„å­˜å™¨ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯</span><br><span class="hljs-type">int</span> on_cpu;                       <span class="hljs-comment">// æ˜¯å¦åœ¨CPUä¸Šè¿è¡Œ</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cpumask</span> *<span class="hljs-title">cpus_allowed</span>;</span>     <span class="hljs-comment">// å…è®¸è¿è¡Œåœ¨å“ªäº›CPUä¸Š</span><br></code></pre></td></tr></table></figure><hr><h3 id="9-æ—¶é—´ç»Ÿè®¡"><a href="#9-æ—¶é—´ç»Ÿè®¡" class="headerlink" title="9. æ—¶é—´ç»Ÿè®¡"></a>9. æ—¶é—´ç»Ÿè®¡</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">u64 utime;                        <span class="hljs-comment">// ç”¨æˆ·æ€è¿è¡Œæ—¶é—´</span><br>u64 stime;                        <span class="hljs-comment">// å†…æ ¸æ€è¿è¡Œæ—¶é—´</span><br></code></pre></td></tr></table></figure><hr><h3 id="10-Cgroup-ä¸èµ„æºé™åˆ¶"><a href="#10-Cgroup-ä¸èµ„æºé™åˆ¶" class="headerlink" title="10. Cgroup ä¸èµ„æºé™åˆ¶"></a>10. Cgroup ä¸èµ„æºé™åˆ¶</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">css_set</span> *<span class="hljs-title">cgroups</span>;</span>          <span class="hljs-comment">// æ‰€å±çš„ cgroup é›†åˆ</span><br></code></pre></td></tr></table></figure><hr><h3 id="11-è°ƒè¯•ä¸è¿½è¸ª"><a href="#11-è°ƒè¯•ä¸è¿½è¸ª" class="headerlink" title="11. è°ƒè¯•ä¸è¿½è¸ª"></a>11. è°ƒè¯•ä¸è¿½è¸ª</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> ptrace;             <span class="hljs-comment">// æ˜¯å¦è¢« ptrace è¿½è¸ª</span><br></code></pre></td></tr></table></figure><hr><h3 id="12-å†…æ ¸åŒæ­¥ä¸é”"><a href="#12-å†…æ ¸åŒæ­¥ä¸é”" class="headerlink" title="12. å†…æ ¸åŒæ­¥ä¸é”"></a>12. å†…æ ¸åŒæ­¥ä¸é”</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">spinlock_t</span> alloc_lock;            <span class="hljs-comment">// ç”¨äºä¿æŠ¤ä»»åŠ¡ç»“æ„ä¸­çš„å…³é”®åŒºåŸŸ</span><br></code></pre></td></tr></table></figure><hr><h3 id="13-å…¶ä»–å¸¸ç”¨å­—æ®µ"><a href="#13-å…¶ä»–å¸¸ç”¨å­—æ®µ" class="headerlink" title="13. å…¶ä»–å¸¸ç”¨å­—æ®µ"></a>13. å…¶ä»–å¸¸ç”¨å­—æ®µ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> comm[TASK_COMM_LEN];         <span class="hljs-comment">// è¿›ç¨‹åï¼ˆæœ€å¤š16å­—èŠ‚ï¼‰</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> *<span class="hljs-title">group_leader</span>;</span> <span class="hljs-comment">// çº¿ç¨‹ç»„çš„ leader</span><br><span class="hljs-type">int</span> exit_code;                    <span class="hljs-comment">// é€€å‡ºä»£ç </span><br></code></pre></td></tr></table></figure><hr><h2 id="ğŸ”§-å°ç»“å›¾è§£ï¼ˆç®€ç•¥ï¼‰"><a href="#ğŸ”§-å°ç»“å›¾è§£ï¼ˆç®€ç•¥ï¼‰" class="headerlink" title="ğŸ”§ å°ç»“å›¾è§£ï¼ˆç®€ç•¥ï¼‰"></a>ğŸ”§ å°ç»“å›¾è§£ï¼ˆç®€ç•¥ï¼‰</h2><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pf">task_struct<br>â”œâ”€â”€ è¿›ç¨‹æ ‡è¯†ï¼špid, tgid<br>â”œâ”€â”€ çŠ¶æ€ä¸è°ƒåº¦ï¼š<span class="hljs-keyword">state</span>, <span class="hljs-keyword">prio</span>, policy, se<br>â”œâ”€â”€ çˆ¶å­å…³ç³»ï¼š<span class="hljs-keyword">parent</span>, children<br>â”œâ”€â”€ å†…å­˜ç®¡ç†ï¼šmm, active_mm<br>â”œâ”€â”€ æ–‡ä»¶ç³»ç»Ÿï¼šfiles, fs<br>â”œâ”€â”€ ä¿¡å·å¤„ç†ï¼šsignal, sighand<br>â”œâ”€â”€ å‘½åç©ºé—´ï¼šnsproxy<br>â”œâ”€â”€ CPUè°ƒåº¦ï¼šthread, on_cpu<br>â”œâ”€â”€ æ—¶é—´ç»Ÿè®¡ï¼šutime, stime<br>â”œâ”€â”€ C<span class="hljs-keyword">group</span>ï¼šcgroups<br>â”œâ”€â”€ åŒæ­¥é”ï¼šalloc_lock<br>â”œâ”€â”€ è°ƒè¯•è¿½è¸ªï¼šptrace<br>â””â”€â”€ é€šç”¨ä¿¡æ¯ï¼šcomm, exit_code<br></code></pre></td></tr></table></figure><hr><p>è¯¥ç»“æ„ä½“å¯èƒ½ä¼šåœ¨ä¸åŒç‰ˆæœ¬çš„å†…æ ¸ä¸­æœ‰æ‰€å˜åŠ¨ï¼Œä½†æ•´ä½“ç»“æ„å’Œè¿™äº›åŠŸèƒ½æ¨¡å—æ˜¯æ ¸å¿ƒã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨çš„å®ç°åŸç†</title>
    <link href="/2025/04/01/%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/"/>
    <url>/2025/04/01/%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="å®¹å™¨å®ç°çš„åŸç†"><a href="#å®¹å™¨å®ç°çš„åŸç†" class="headerlink" title="å®¹å™¨å®ç°çš„åŸç†"></a>å®¹å™¨å®ç°çš„åŸç†</h1><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå®¹å™¨çš„å®ç°æœ¬èº«å°±æ˜¯ä¸€ç§èµ„æºéš”ç¦»çš„æ–¹å¼ã€‚å®ƒé€šè¿‡æ§åˆ¶è¿›ç¨‹çš„èµ„æºè°ƒåº¦ï¼Œè®¿é—®æƒé™æ¥ç¡®å®šä¸€é¡¹è¿›ç¨‹å¯ä»¥æ“ä½œçš„èµ„æºèŒƒå›´ï¼Œæ¥è¾¾åˆ°éš”ç¦»çš„ç›®çš„</p><p>è¿™å…¶ä¸­ä¸»è¦ä½¿ç”¨åˆ°3ä¸ªæŠ€æœ¯ ï¼š namespaceï¼Œunionfs å’Œcgroups</p><h1 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h1><p>namespace æ˜¯ä¸€ç§æ§åˆ¶è¿›ç¨‹è®¿é—®èŒƒå›´çš„ç»“æ„ä½“ã€‚åœ¨è¿›ç¨‹ç»“æ„ä½“ï¼ˆtask_structï¼‰ä¸­ï¼Œé€šè¿‡nsproxy ç»“æ„ æŒ‡å‘ä¸€ä¸ªåŒ…å«å¤šç§èµ„æºç»“æ„æŒ‡é’ˆçš„ç»“æ„ä½“ã€‚</p><p>struct nsproxy :</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nsproxy</span> &#123;</span><br>    <span class="hljs-type">atomic_t</span> count;                  <span class="hljs-comment">// å¼•ç”¨è®¡æ•°</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">uts_namespace</span> *<span class="hljs-title">uts_ns</span>;</span>   <span class="hljs-comment">// UTS å‘½åç©ºé—´ï¼ˆä¸»æœºåã€åŸŸåï¼‰</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ipc_namespace</span> *<span class="hljs-title">ipc_ns</span>;</span>   <span class="hljs-comment">// IPC å‘½åç©ºé—´ï¼ˆä¿¡å·é‡ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mnt_namespace</span> *<span class="hljs-title">mnt_ns</span>;</span>   <span class="hljs-comment">// æŒ‚è½½å‘½åç©ºé—´ï¼ˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ï¼‰</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid_namespace</span> *<span class="hljs-title">pid_ns_for_children</span>;</span> <span class="hljs-comment">// PID å‘½åç©ºé—´ï¼ˆç”¨äºå­è¿›ç¨‹ï¼‰</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">net</span> *<span class="hljs-title">net_ns</span>;</span>             <span class="hljs-comment">// ç½‘ç»œå‘½åç©ºé—´</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_CGROUPS</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup_namespace</span> *<span class="hljs-title">cgroup_ns</span>;</span> <span class="hljs-comment">// æ§åˆ¶ç»„å‘½åç©ºé—´</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_TIME_NS</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">time_namespace</span> *<span class="hljs-title">time_ns</span>;</span>     <span class="hljs-comment">// æ—¶é—´å‘½åç©ºé—´</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;;<br><br></code></pre></td></tr></table></figure><h2 id="å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š"><a href="#å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š" class="headerlink" title="å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š"></a>å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š</h2><table><thead><tr><th>å­—æ®µå</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>count</code></td><td>å¼•ç”¨è®¡æ•°ï¼Œé¿å…ç»“æ„ä½“è¢«è¿‡æ—©é‡Šæ”¾</td></tr><tr><td><code>uts_ns</code></td><td>UTS å‘½åç©ºé—´ï¼ˆ<code>uname -n</code>ã€ä¸»æœºåç­‰ï¼‰</td></tr><tr><td><code>ipc_ns</code></td><td>IPC å‘½åç©ºé—´ï¼ˆSysV IPCï¼Œå¦‚ä¿¡å·é‡ã€å…±äº«å†…å­˜ï¼‰</td></tr><tr><td><code>mnt_ns</code></td><td>æŒ‚è½½å‘½åç©ºé—´ï¼ˆéš”ç¦»çš„æŒ‚è½½è§†å›¾ï¼‰</td></tr><tr><td><code>pid_ns_for_children</code></td><td>å½“å‰è¿›ç¨‹çš„å­è¿›ç¨‹å°†è¿›å…¥çš„ PID å‘½åç©ºé—´</td></tr><tr><td><code>net_ns</code></td><td>ç½‘ç»œå‘½åç©ºé—´ï¼ˆå¦‚ç½‘ç»œè®¾å¤‡ã€IP åœ°å€ã€è·¯ç”±ç­‰ï¼‰</td></tr><tr><td><code>cgroup_ns</code></td><td>æ§åˆ¶ç»„å‘½åç©ºé—´ï¼ˆæ§åˆ¶ç»„çš„åå­—ç©ºé—´éš”ç¦»ï¼‰</td></tr><tr><td><code>time_ns</code></td><td>æ—¶é—´å‘½åç©ºé—´ï¼ˆæ¯ä¸ªå®¹å™¨&#x2F;å‘½åç©ºé—´è‡ªå·±çš„æ—¶é—´è§†å›¾ï¼‰</td></tr></tbody></table><p>å½“è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œæœªå®šä¹‰çš„å‘½åç©ºé—´ ä¼šé»˜è®¤ä½¿ç”¨çˆ¶è¿›ç¨‹çš„ç»“æ„ä½“ä¿¡æ¯ï¼ˆå¯ä»¥é€šè¿‡clone()æ¥æŒ‡å®šå­è¿›ç¨‹éœ€è¦ç»‘å®šçš„å‘½åç©ºé—´ï¼‰ã€‚æ‰€ä»¥å½“æ–°çš„å­è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œé»˜è®¤ç›´æ¥å¯ä»¥è®¿é—®çˆ¶è¿›ç¨‹æ‰€èƒ½ä½¿ç”¨çš„èµ„æºã€‚</p><h2 id="åˆ›å»ºæ–°çš„å‘½åç©ºé—´"><a href="#åˆ›å»ºæ–°çš„å‘½åç©ºé—´" class="headerlink" title="åˆ›å»ºæ–°çš„å‘½åç©ºé—´"></a>åˆ›å»ºæ–°çš„å‘½åç©ºé—´</h2><p>é€šè¿‡ä½¿ç”¨ unshare å‘½ä»¤æ¥åˆ›å»ºæ–°çš„å‘½åç©ºé—´ã€‚æ“ä½œç³»ç»Ÿä¼šå¯¹æ¯ç§èµ„æºè¿›è¡Œç›¸åº”çš„åˆå§‹åŒ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">unshare --fork --pid --mount --uts --ipc --net --user --map-root-user /bin/bash<br></code></pre></td></tr></table></figure><p><code>unshare</code> å¯ä»¥è®©ä½ ä¸ºè¿›ç¨‹å•ç‹¬åˆ›å»ºä»¥ä¸‹å‘½åç©ºé—´ï¼š</p><table><thead><tr><th>å‘½åç©ºé—´</th><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>UTS</td><td><code>--uts</code></td><td>ä¸»æœºå&#x2F;åŸŸåéš”ç¦»ï¼ˆå¯ä»¥æ”¹ hostnameï¼‰</td></tr><tr><td>PID</td><td><code>--pid</code></td><td>è¿›ç¨‹å·éš”ç¦»ï¼ˆæ–°çš„è¿›ç¨‹æ ‘ï¼Œå½“å‰è¿›ç¨‹æ˜¯ PID 1ï¼‰</td></tr><tr><td>Mount</td><td><code>--mount</code></td><td>æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹éš”ç¦»</td></tr><tr><td>Net</td><td><code>--net</code></td><td>ç½‘ç»œæ ˆéš”ç¦»ï¼ˆç‹¬ç«‹çš„ç½‘ç»œæ¥å£ï¼‰</td></tr><tr><td>IPC</td><td><code>--ipc</code></td><td>è¿›ç¨‹é—´é€šä¿¡éš”ç¦»</td></tr><tr><td>User</td><td><code>--user</code></td><td>ç”¨æˆ·&#x2F;æƒé™éš”ç¦»ï¼ˆuid&#x2F;gid æ˜ å°„ï¼‰</td></tr><tr><td>Cgroup</td><td><code>--cgroup</code></td><td>æ§åˆ¶ç»„éš”ç¦»</td></tr><tr><td>Time</td><td><code>--time</code></td><td>ç³»ç»Ÿæ—¶é—´å‘½åç©ºé—´ï¼ˆè¾ƒæ–°å†…æ ¸ï¼‰</td></tr></tbody></table><p> ä½¿ç”¨ - -mount ä¼šå°†å½“å‰è¿›ç¨‹çš„æŒ‚è½½ç³»ç»Ÿè§†å›¾åŠ è½½åˆ°æ–°çš„è¿›ç¨‹ä¸­å»</p><p>ä½¿ç”¨  - -mount-proc ä¼šåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„&#x2F;proc æ–‡ä»¶ç³»ç»Ÿ</p><p>è¿›å…¥æ–°çš„å‘½åç©ºé—´åï¼Œè¿›è¡Œèµ„æºæŒ‚è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">unshare --mount --net --user --map-root-user bash<br><br>mount -t tmpfs tmpfs /mnt/tmp  <span class="hljs-comment">#æ–‡ä»¶ç³»ç»ŸæŒ‚è½½</span><br>ip <span class="hljs-built_in">link</span> <span class="hljs-built_in">set</span> lo up <span class="hljs-comment">#ç½‘ç»œæŒ‚è½½</span><br>mount -t proc proc /proc <span class="hljs-comment">#è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸæŒ‚è½½</span><br><span class="hljs-comment"># --user è¦ä¹ˆç”¨ --map-root-userï¼Œè¦ä¹ˆè‡ªå·±å†™ uid_map</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªè‡ªå®šä¹‰èµ„æºé¢„è®¾å‘½åç©ºé—´çš„è¿›ç¨‹</p><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="unshare-â€”uts-â€”pid-bin-bash-éœ€è¦é€šè¿‡â€”forkåˆ›å»ºæ–°çš„å‘½åç©ºé—´"><a href="#unshare-â€”uts-â€”pid-bin-bash-éœ€è¦é€šè¿‡â€”forkåˆ›å»ºæ–°çš„å‘½åç©ºé—´" class="headerlink" title="unshare  â€”uts â€”pid  &#x2F;bin&#x2F;bash éœ€è¦é€šè¿‡â€”forkåˆ›å»ºæ–°çš„å‘½åç©ºé—´"></a>unshare  â€”uts â€”pid  &#x2F;bin&#x2F;bash éœ€è¦é€šè¿‡â€”forkåˆ›å»ºæ–°çš„å‘½åç©ºé—´</h3><p>ä½¿ç”¨ <code>unshare --pid</code> åˆ›å»ºæ–°çš„ PID å‘½åç©ºé—´åï¼Œå½“å‰è¿›ç¨‹ä¾ç„¶å¤„äºæ—§å‘½åç©ºé—´ï¼Œå®ƒçš„ PID æ— æ³•æ›´æ”¹ã€‚å› æ­¤å¿…é¡»é€šè¿‡ <code>--fork</code> åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œå®ƒæ‰èƒ½çœŸæ­£è¿è¡Œåœ¨æ–°çš„ PID å‘½åç©ºé—´ä¸­ï¼Œå¹¶æˆä¸ºè¯¥å‘½åç©ºé—´å†…çš„ PID 1ã€‚</p><h3 id="å¦‚ä½•è¿›å…¥ä¸€ä¸ªå‘½åç©ºé—´"><a href="#å¦‚ä½•è¿›å…¥ä¸€ä¸ªå‘½åç©ºé—´" class="headerlink" title="å¦‚ä½•è¿›å…¥ä¸€ä¸ªå‘½åç©ºé—´"></a>å¦‚ä½•è¿›å…¥ä¸€ä¸ªå‘½åç©ºé—´</h3><p>Linux æŠŠæ¯ä¸ªè¿›ç¨‹å½“å‰æ‰€åœ¨çš„å‘½åç©ºé—´æš´éœ²åœ¨äº† <code>/proc/[pid]/ns/</code> ç›®å½•ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®å®ƒæ¥â€œè¿›å…¥â€å‘½åç©ºé—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash<br><span class="hljs-built_in">sudo</span> nsenter --target &lt;PID&gt; --net --uts --pid --mount --ipc /bin/bash<br></code></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡ <code>bind mount</code> çš„æ–¹å¼æŠŠ namespace æ–‡ä»¶æŒ‚åˆ°ä¸€ä¸ªè·¯å¾„ä¸Šï¼Œå®ç°â€œå‘½åç©ºé—´æŒä¹…åŒ–â€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /var/run/my_ns<br><span class="hljs-built_in">touch</span> /var/run/my_ns/net<br>mount --<span class="hljs-built_in">bind</span> /proc/&lt;pid&gt;/ns/net /var/run/my_ns/net<br><br></code></pre></td></tr></table></figure><h3 id="è¿›ç¨‹åœ¨ä¸åŒå‘½åç©ºé—´å…·æœ‰ä¸åŒçš„PIDä¿¡æ¯"><a href="#è¿›ç¨‹åœ¨ä¸åŒå‘½åç©ºé—´å…·æœ‰ä¸åŒçš„PIDä¿¡æ¯" class="headerlink" title="è¿›ç¨‹åœ¨ä¸åŒå‘½åç©ºé—´å…·æœ‰ä¸åŒçš„PIDä¿¡æ¯"></a>è¿›ç¨‹åœ¨ä¸åŒå‘½åç©ºé—´å…·æœ‰ä¸åŒçš„PIDä¿¡æ¯</h3><p>å…³é”®ç»“æ„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid</span> &#123;</span><br><span class="hljs-type">atomic_t</span> count;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> level;  <span class="hljs-comment">// å‘½åç©ºé—´å±‚çº§ï¼ˆ0 = rootï¼‰</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hlist_head</span> <span class="hljs-title">tasks</span>[<span class="hljs-title">PIDTYPE_MAX</span>];</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">upid</span> <span class="hljs-title">numbers</span>[1];</span> <span class="hljs-comment">// å®é™…çš„ PID æ•°ç»„ï¼ˆå¤šä¸ªå‘½åç©ºé—´çš„ PIDï¼‰</span><br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">upid</span> &#123;</span><br>    <span class="hljs-type">int</span> nr;                      <span class="hljs-comment">// å½“å‰ namespace ä¸‹çš„ PID</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pid_namespace</span> *<span class="hljs-title">ns</span>;</span>   <span class="hljs-comment">// å±äºå“ªä¸ª namespace</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>ç”±æ­¤ æˆ‘ä»¬å¯ä»¥çœ‹åˆ° unshare æ˜¯ä¸€ä¸ªå¯¹è¿›ç¨‹çš„èµ„æºæƒé™è¿›è¡Œåˆ›å»ºç»‘å®šçš„è¿‡ç¨‹</p><h1 id="overlayfs"><a href="#overlayfs" class="headerlink" title="overlayfs"></a>overlayfs</h1><p>åœ¨å®ç°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå¸¸ä½¿ç”¨çš„æ˜¯ <code>overlayfs</code>ï¼ˆå±äº unionfs ç±»å‹çš„èšåˆæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚ç”¨æ¥å°†å®¹å™¨æ‰€éœ€è¦çš„æ–‡ä»¶èµ„æºâ€œèšåˆâ€åœ¨åŒä¸€ä¸ªèµ„æºç›®å½•ä¸‹ã€‚</p><p>é€šè¿‡mount åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mount -t overlay overlay \<br>  -o lowerdir=/mnt/lower,upperdir=/mnt/upper,workdir=/mnt/work \<br>  /mnt/merged<br><br></code></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>-t overlay</code></td><td>æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹æ˜¯ <code>overlay</code></td></tr><tr><td><code>overlay</code></td><td>è®¾å¤‡åï¼ˆè¿™é‡Œå¯ä»¥éšä¾¿å†™ï¼Œæ¯”å¦‚ä¹Ÿå¯ä»¥å†™æˆ <code>none</code>ï¼‰</td></tr><tr><td><code>-o lowerdir=...</code></td><td>æŒ‡å®šåªè¯»çš„åº•å±‚ç›®å½•ï¼ˆå¯å¤šä¸ªï¼‰</td></tr><tr><td><code>upperdir=...</code></td><td>æŒ‡å®šå¯å†™çš„ä¸Šå±‚ç›®å½•</td></tr><tr><td><code>workdir=...</code></td><td>overlayfs éœ€è¦çš„å·¥ä½œç›®å½•ï¼ˆä¸­é—´ç¼“å­˜ç”¨ï¼‰</td></tr><tr><td>æœ€åçš„ <code>rootfs_chat/merged</code></td><td>æ˜¯æŒ‚è½½ç‚¹ï¼Œå³æœ€ç»ˆç»„åˆå‡ºæ¥çš„ç›®å½•è§†å›¾</td></tr></tbody></table><p>æŒ‚è½½åˆ›å»ºå¥½åï¼Œå› ä¸ºè¯¥æŒ‚è½½å­˜åœ¨äºçˆ¶è¿›ç¨‹ä¹‹ä¸­ï¼Œæ‰€ä»¥ä½¿ç”¨â€”mountåˆ›å»ºåï¼Œæ–°çš„å­è¿›ç¨‹å¯ä»¥è®¿é—®åˆ°è¯¥æŒ‚è½½è·¯å¾„</p><p>ä½†æ˜¯æ­¤æ—¶çš„æ ¹è·¯å¾„ä¾ç„¶ç»§æ‰¿è‡ªçˆ¶è¿›ç¨‹ï¼Œæ‰€ä»¥éœ€è¦å°†æ–°è¿›ç¨‹çš„æ ¹è¿›ç¨‹ä¿®æ”¹ä¸ºâ€œ&#x2F;â€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chroot</span> rootfs_chat/merged/ <br></code></pre></td></tr></table></figure><p><code>chroot</code> æœ¬èº«å¹¶ä¸å®‰å…¨ï¼Œä¸èƒ½å®Œå…¨éš”ç¦»æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦ç»“åˆ mount namespace æ‰èƒ½ä¿è¯éš”ç¦»æ€§ã€‚å¦åˆ™è¿›ç¨‹å¯ä»¥ escape chrootã€‚</p><h2 id="QA-1"><a href="#QA-1" class="headerlink" title="QA"></a>QA</h2><p>chroot é€šè¿‡ä¿®æ”¹è¿›ç¨‹ç»“æ„ä½“ä¸­çš„â€œrootâ€ å˜é‡ï¼Œæ¥å¸®åŠ©è¿›ç¨‹è¯†åˆ«å¯¹åº”çš„æ ¹ç›®å½•çš„</p><p>{</p><p>struct fs_struct {<br>struct path root;     &#x2F;&#x2F; å½“å‰çš„æ ¹ç›®å½•ï¼ˆå¯¹åº” <code>/</code>ï¼‰<br>struct path pwd;      &#x2F;&#x2F; å½“å‰å·¥ä½œç›®å½•ï¼ˆå¯¹åº” <code>.</code>ï¼‰<br>};</p><h1 id="cgroups"><a href="#cgroups" class="headerlink" title="cgroups"></a>cgroups</h1><p>cgroup æ˜¯ä¸€ä¸ªå†…æ ¸ä¸­çš„â€œèµ„æºæ§åˆ¶æ ‘ç»“æ„â€ï¼Œè¿›ç¨‹â€œåŠ å…¥â€åˆ°è¿™ä¸ªæ ‘ç»“æ„çš„æŸä¸ªèŠ‚ç‚¹ä¸‹ï¼Œè¿›è€Œæ¥å—æ§åˆ¶å™¨çš„çº¦æŸã€‚</p><p>ç»“æ„ä½“å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kernfs_node</span> *<span class="hljs-title">kn</span>;</span>         <span class="hljs-comment">// åœ¨ cgroupfs ä¸­å¯¹åº”çš„ç›®å½•èŠ‚ç‚¹</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup_subsys_state</span> __<span class="hljs-title">rcu</span> *<span class="hljs-title">subsys</span>[<span class="hljs-title">CGROUP_SUBSYS_COUNT</span>];</span> <span class="hljs-comment">// æ§åˆ¶å™¨çŠ¶æ€</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup_parent</span> *<span class="hljs-title">parent</span>;</span>   <span class="hljs-comment">// çˆ¶ cgroup</span><br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ§åˆ¶å™¨ç»“æ„ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup_subsys_state</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup</span> *<span class="hljs-title">cgroup</span>;</span>       <span class="hljs-comment">// å±äºå“ªä¸ª cgroup èŠ‚ç‚¹</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">cgroup_subsys</span> *<span class="hljs-title">ss</span>;</span>    <span class="hljs-comment">// å±äºå“ªä¸ªæ§åˆ¶å™¨ï¼ˆmemory, cpuç­‰ï¼‰</span><br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¿›ç¨‹ç»“æ„ä½“ä¸­å¯¹cgroupçš„å¼•ç”¨ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> &#123;</span><br>    ...<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">css_set</span> *<span class="hljs-title">cgroups</span>;</span>    <span class="hljs-comment">// è¿›ç¨‹æ‰€å±çš„ cgroup é›†åˆï¼ˆcss_setï¼‰</span><br>    ...<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="cgroupsé™åˆ¶å†™å…¥"><a href="#cgroupsé™åˆ¶å†™å…¥" class="headerlink" title="cgroupsé™åˆ¶å†™å…¥"></a>cgroupsé™åˆ¶å†™å…¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /sys/fs/cgroup/mygroup<br><span class="hljs-built_in">echo</span> 1234 &gt; /sys/fs/cgroup/mygroup/cgroup.procs  <span class="hljs-comment">#å°†æŸä¸ªè¿›ç¨‹åŠ å…¥èµ„æºç»„</span><br><span class="hljs-built_in">echo</span> 50M &gt; /sys/fs/cgroup/mygroup/memory.max  <span class="hljs-comment">#åœ¨å¯¹åº”çš„è™šæ‹Ÿæ–‡ä»¶ä¸­è®¾ç½®é™åˆ¶å€¼çš„å¤§å°</span><br><br></code></pre></td></tr></table></figure><h2 id="é™åˆ¶æ–¹å¼"><a href="#é™åˆ¶æ–¹å¼" class="headerlink" title="é™åˆ¶æ–¹å¼"></a>é™åˆ¶æ–¹å¼</h2><h3 id="1-å†…å­˜é™åˆ¶ï¼ˆmemory-controllerï¼‰"><a href="#1-å†…å­˜é™åˆ¶ï¼ˆmemory-controllerï¼‰" class="headerlink" title="1. å†…å­˜é™åˆ¶ï¼ˆmemory controllerï¼‰"></a>1. <strong>å†…å­˜é™åˆ¶ï¼ˆmemory controllerï¼‰</strong></h3><h3 id="æ§åˆ¶æ–‡ä»¶ï¼ˆcgroups-v2ï¼‰ï¼š"><a href="#æ§åˆ¶æ–‡ä»¶ï¼ˆcgroups-v2ï¼‰ï¼š" class="headerlink" title="æ§åˆ¶æ–‡ä»¶ï¼ˆcgroups v2ï¼‰ï¼š"></a>æ§åˆ¶æ–‡ä»¶ï¼ˆcgroups v2ï¼‰ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">memory.max        <span class="hljs-comment"># æœ€å¤§å†…å­˜</span><br>memory.current    <span class="hljs-comment"># å½“å‰å†…å­˜ä½¿ç”¨é‡</span><br>memory.swap.max   <span class="hljs-comment"># æœ€å¤§ swap ä½¿ç”¨</span><br><br></code></pre></td></tr></table></figure><h3 id="é™åˆ¶æœºåˆ¶ï¼š"><a href="#é™åˆ¶æœºåˆ¶ï¼š" class="headerlink" title="é™åˆ¶æœºåˆ¶ï¼š"></a>é™åˆ¶æœºåˆ¶ï¼š</h3><ul><li>æ¯æ¬¡è¿›ç¨‹åˆ†é…å†…å­˜ï¼ˆ<code>malloc</code> &#x2F; <code>brk</code> &#x2F; <code>mmap</code>ï¼‰ï¼Œå†…æ ¸ä¼šé€šè¿‡ cgroup è¿½è¸ªå®ƒçš„é¡µæ•°</li><li>å†…æ ¸ç»´æŠ¤ä¸€ä¸ªâ€œ<strong>å†…å­˜è´¦æˆ·</strong>â€ï¼Œè®°å½•æ¯ä¸ª cgroup å½“å‰ä½¿ç”¨äº†å¤šå°‘å†…å­˜</li><li>å½“ä½¿ç”¨è¶…è¿‡ <code>memory.max</code>ï¼š<ul><li>å¦‚æœæ˜¯è½¯é™åˆ¶ï¼ˆmemory.highï¼‰ï¼šå†…æ ¸ä¼˜å…ˆå›æ”¶ç¼“å­˜é¡µ</li><li>å¦‚æœæ˜¯ç¡¬é™åˆ¶ï¼ˆmemory.maxï¼‰ï¼šå†…æ ¸ä¼šæ‹’ç»åˆ†é…ï¼Œæˆ–è€…ç›´æ¥ OOM æ€æ­»è¿›ç¨‹</li></ul></li></ul><hr><h3 id="2-CPU-é™åˆ¶ï¼ˆcpu-controllerï¼‰"><a href="#2-CPU-é™åˆ¶ï¼ˆcpu-controllerï¼‰" class="headerlink" title="2. CPU é™åˆ¶ï¼ˆcpu controllerï¼‰"></a>2. <strong>CPU é™åˆ¶ï¼ˆcpu controllerï¼‰</strong></h3><h3 id="æ§åˆ¶æ–‡ä»¶ï¼š"><a href="#æ§åˆ¶æ–‡ä»¶ï¼š" class="headerlink" title="æ§åˆ¶æ–‡ä»¶ï¼š"></a>æ§åˆ¶æ–‡ä»¶ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">cpu.max           <span class="hljs-comment"># æ ¼å¼ä¸º &quot;quota period&quot;ï¼Œå¦‚ &quot;50000 100000&quot; è¡¨ç¤º 50%</span><br>cpu.weight        <span class="hljs-comment"># æ¯”ä¾‹è°ƒåº¦ï¼ˆç±»ä¼¼ nice å€¼ï¼‰</span><br><br></code></pre></td></tr></table></figure><h3 id="é™åˆ¶æœºåˆ¶ï¼š-1"><a href="#é™åˆ¶æœºåˆ¶ï¼š-1" class="headerlink" title="é™åˆ¶æœºåˆ¶ï¼š"></a>é™åˆ¶æœºåˆ¶ï¼š</h3><ul><li>Linux ç”¨ <strong>CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰</strong> ç®¡ç† CPU æ—¶é—´</li><li>cgroups ä¸­æ¯ä¸ªç»„éƒ½ç»´æŠ¤ä¸€ä¸ªâ€œè™šæ‹Ÿæ—¶é—´â€å’Œâ€œå®é™…ç”¨é‡â€</li><li>å½“æŸä¸ª cgroup è¶…è¿‡åˆ†é…çš„ quotaï¼Œ<strong>è°ƒåº¦å™¨ä¼šâ€œè·³è¿‡â€å®ƒçš„è¿›ç¨‹ï¼Œè®©å‡º CPU</strong></li><li>å®ç°ç±»ä¼¼â€œé™é€Ÿâ€ï¼šæ¯”å¦‚æ¯ 100ms æœ€å¤šç”¨ 50msï¼Œå°±ç­‰äº 50% CPU</li></ul><hr><h3 id="3-IO-é™åˆ¶ï¼ˆio-controllerï¼‰"><a href="#3-IO-é™åˆ¶ï¼ˆio-controllerï¼‰" class="headerlink" title="3. IO é™åˆ¶ï¼ˆio controllerï¼‰"></a>3. <strong>IO é™åˆ¶ï¼ˆio controllerï¼‰</strong></h3><h3 id="æ§åˆ¶æ–‡ä»¶ï¼š-1"><a href="#æ§åˆ¶æ–‡ä»¶ï¼š-1" class="headerlink" title="æ§åˆ¶æ–‡ä»¶ï¼š"></a>æ§åˆ¶æ–‡ä»¶ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">o.max            <span class="hljs-comment"># é™åˆ¶è¯»å†™é€Ÿç‡</span><br>io.weight         <span class="hljs-comment"># ç›¸å¯¹ä¼˜å…ˆçº§</span><br><br></code></pre></td></tr></table></figure><h3 id="é™åˆ¶æœºåˆ¶ï¼š-2"><a href="#é™åˆ¶æœºåˆ¶ï¼š-2" class="headerlink" title="é™åˆ¶æœºåˆ¶ï¼š"></a>é™åˆ¶æœºåˆ¶ï¼š</h3><ul><li>å½“è¿›ç¨‹è®¿é—®ç£ç›˜ï¼ˆè¯»&#x2F;å†™ï¼‰æ—¶ï¼Œå†…æ ¸é€šè¿‡ block å±‚æ£€æŸ¥å®ƒæ‰€åœ¨çš„ cgroup</li><li>å¦‚æœå½“å‰ç»„å·²è¾¾åˆ°é€Ÿç‡ä¸Šé™ï¼Œåˆ™æ’é˜Ÿ</li><li>ç”¨çš„æ˜¯<strong>èŠ‚æµç®—æ³•ï¼ˆtoken bucket + deadlineï¼‰</strong>ï¼ŒæŒ‰æ¯”ä¾‹åˆ†å‘ IO æœºä¼š</li></ul><hr><h3 id="4-è¿›ç¨‹æ•°é™åˆ¶ï¼ˆpids-controllerï¼‰"><a href="#4-è¿›ç¨‹æ•°é™åˆ¶ï¼ˆpids-controllerï¼‰" class="headerlink" title="4. è¿›ç¨‹æ•°é™åˆ¶ï¼ˆpids controllerï¼‰"></a>4. <strong>è¿›ç¨‹æ•°é™åˆ¶ï¼ˆpids controllerï¼‰</strong></h3><h3 id="æ§åˆ¶æ–‡ä»¶ï¼š-2"><a href="#æ§åˆ¶æ–‡ä»¶ï¼š-2" class="headerlink" title="æ§åˆ¶æ–‡ä»¶ï¼š"></a>æ§åˆ¶æ–‡ä»¶ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">pids.max         <span class="hljs-comment"># æœ€å¤§å¯åˆ›å»ºè¿›ç¨‹æ•°</span><br>pids.current     <span class="hljs-comment"># å½“å‰å·²åˆ›å»ºçš„è¿›ç¨‹æ•°</span><br><br></code></pre></td></tr></table></figure><h2 id="å¤„ç†æµç¨‹"><a href="#å¤„ç†æµç¨‹" class="headerlink" title="å¤„ç†æµç¨‹"></a>å¤„ç†æµç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">è¿›ç¨‹è°ƒç”¨ç³»ç»Ÿèµ„æºï¼ˆå¦‚å†…å­˜åˆ†é…ã€CPUæ‰§è¡Œã€ç£ç›˜è¯»å†™ï¼‰  <br>      â†“  <br>å†…æ ¸è§¦å‘èµ„æºæ§åˆ¶å™¨çš„é’©å­å‡½æ•°ï¼ˆå¦‚ memory, cpu, io, pidsï¼‰  <br>      â†“  <br>å†…æ ¸æŸ¥æ‰¾è¯¥è¿›ç¨‹æ‰€å±çš„ cgroup èŠ‚ç‚¹  <br>      â†“  <br>è¯»å–å½“å‰ä½¿ç”¨ç»Ÿè®¡ï¼ˆå¦‚ memory.currentã€cpu.statï¼‰  <br>      â†“  <br>ä¸é…ç½®çš„é™åˆ¶ï¼ˆå¦‚ memory.maxã€cpu.maxï¼‰åšæ¯”è¾ƒ  <br>      â†“  <br>æ ¹æ®æ§åˆ¶å™¨çš„é€»è¾‘æ‰§è¡Œï¼š<br>    â”œâ”€â”€ âœ… å…è®¸ï¼ˆèµ„æºæœªè¶…é™ï¼‰<br>    â”œâ”€â”€ ğŸš« æ‹’ç»ï¼ˆå¦‚ fork è¢«æ‹’ç»ï¼‰<br>    â”œâ”€â”€ ğŸ§¹ è§¦å‘å›æ”¶ï¼ˆå¦‚å†…å­˜å›æ”¶ç¼“å­˜é¡µï¼‰<br>    â””â”€â”€ ğŸ’£ æ€æ­»è¿›ç¨‹ï¼ˆå¦‚ OOM killerï¼‰<br><br></code></pre></td></tr></table></figure><h3 id="ä¸åŒèµ„æºçš„æ§åˆ¶æ–¹å¼ç¤ºæ„ï¼š"><a href="#ä¸åŒèµ„æºçš„æ§åˆ¶æ–¹å¼ç¤ºæ„ï¼š" class="headerlink" title="ä¸åŒèµ„æºçš„æ§åˆ¶æ–¹å¼ç¤ºæ„ï¼š"></a>ä¸åŒèµ„æºçš„æ§åˆ¶æ–¹å¼ç¤ºæ„ï¼š</h3><table><thead><tr><th>èµ„æºç±»å‹</th><th>é’©å­ç‚¹ï¼ˆå†…æ ¸è¡Œä¸ºï¼‰</th><th>æ§åˆ¶è¡Œä¸º</th></tr></thead><tbody><tr><td>Memory</td><td>åˆ†é…é¡µï¼ˆ<code>alloc_pages</code>ï¼‰</td><td>æ‹’ç»åˆ†é… &#x2F; å›æ”¶ &#x2F; OOM</td></tr><tr><td>CPU</td><td>è°ƒåº¦å™¨ï¼ˆ<code>schedule</code>ï¼‰</td><td>è·³è¿‡è°ƒåº¦ &#x2F; é™é€Ÿ</td></tr><tr><td>IO</td><td><code>submit_bio()</code> &#x2F; IOè°ƒåº¦</td><td>èŠ‚æµ &#x2F; æ’é˜Ÿ</td></tr><tr><td>PIDs</td><td>åˆ›å»ºè¿›ç¨‹ï¼ˆ<code>fork()</code>ï¼‰</td><td>ç›´æ¥å¤±è´¥</td></tr><tr><td>NetCls</td><td>å‘åŒ…ã€Qos åˆ†ç±»</td><td>åŠ æ ‡ç­¾é™æµ</td></tr><tr><td>Devices</td><td>æ‰“å¼€æ–‡ä»¶ï¼ˆ<code>open()</code>ï¼‰</td><td>æ‹’ç»è®¿é—®è®¾å¤‡</td></tr></tbody></table><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å®¹å™¨çš„åˆ›å»ºè¿‡ç¨‹</p><ol><li>åˆ›å»ºèšåˆæ–‡ä»¶ç³»ç»Ÿï¼Œå°†å®¹å™¨æ‰€éœ€è¦çš„æ–‡ä»¶ç»Ÿä¸€åˆ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä¸‹</li><li>åˆ›å»ºå‘½åç©ºé—´ï¼Œåˆå§‹åŒ–å‘½åç©ºé—´ä¸­çš„èµ„æºè·¯å¾„</li><li>å°†çˆ¶è¿›ç¨‹ä¸­åˆ›å»ºçš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å­è¿›ç¨‹ä¸­ï¼Œå°†å­è¿›ç¨‹æ ¹ç›®å½•æŒ‡å‘æŒ‚è½½ç›®å½•</li><li>æŸ¥è¯¢è¿›ç¨‹çš„PIDå·ï¼Œåˆ›å»ºcgroupæ–‡ä»¶ï¼Œæ·»åŠ å¯¹è¯¥è¿›ç¨‹çš„èµ„æºé™åˆ¶ã€‚</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>è™šæ‹ŸåŒ–æŠ€æœ¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Difyçš„Chatflowå®ç°</title>
    <link href="/2025/03/28/Dify%E7%9A%84Chatflow%E5%AE%9E%E7%8E%B0/"/>
    <url>/2025/03/28/Dify%E7%9A%84Chatflow%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ä¸Šä¸€æ¬¡çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€äº›åŠŸèƒ½å®ç°ã€‚</p><p>é€šè¿‡å‘å¤§æ¨¡å‹æè¿°è¯·æ±‚æ¥å®Œæˆä¸€äº›æœåŠ¡å™¨ç«¯çš„åŠŸèƒ½</p><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>æµç¨‹ Dify Chatflow ä»»åŠ¡æµ â†’ è‡ªå®šä¹‰æ’ä»¶æ„å»ºå®¢æˆ·ç«¯è¯·æ±‚ â†’ æœåŠ¡å™¨ç«¯ç›‘å¬è¯·æ±‚ï¼Œè§£æè¯·æ±‚å¹¶å¤„ç† â†’æ’ä»¶æ¥æ”¶è¯·æ±‚å“åº”ï¼Œä¼ é€’ç»“æœç»™LLM è¿›è¡Œä¼˜åŒ–å±•ç¤ºã€‚</p><h2 id="åˆ›å»ºä»»åŠ¡æµ"><a href="#åˆ›å»ºä»»åŠ¡æµ" class="headerlink" title="åˆ›å»ºä»»åŠ¡æµ"></a>åˆ›å»ºä»»åŠ¡æµ</h2><p>åˆ›å»ºç©ºç™½åº”ç”¨â†’Chatflow</p><p>ChatFlowæ˜¯ç”±å¤šä¸ªç»„ä»¶æ„æˆçš„å·¥ä½œæµç¨‹</p><p><img src="https://i.111666.best/image/4MRRqKxQVG504FjR2SaGTk.png" alt="image"></p><p>åœ¨è¿™ä¸ªå·¥ä½œæµç¨‹ä¸­ï¼Œæ¯æ¬¡çš„å¯¹è¯ä¼šè¢«ä½œä¸ºè¾“å…¥å‚æ•°ä¼ å…¥åˆ°å·¥ä½œæµä¸­è¿›è¡Œå¤„ç†</p><p>å½“å‰å®ç°çš„åŠŸèƒ½ ï¼š </p><ol><li>æŸ¥è¯¢æœåŠ¡å™¨å…è®¸æ‰§è¡Œçš„å‘½ä»¤è¡Œå·¥å…·</li><li>ç”±å¤§æ¨¡å‹åˆ†æç”¨æˆ·æŒ‡ä»¤ï¼Œä»æä¾›çš„å‘½ä»¤åˆ—è¡¨ä¸­ç»„ç»‡å‘½ä»¤æµç¨‹ä¸‹å‘åˆ°æœåŠ¡å™¨ç«¯æ‰§è¡Œ</li></ol><p>è¿™é‡Œçš„ç¼–æ’</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">å¼€å§‹-é—®é¢˜åˆ†ç±»å™¨-æƒ…å†µ1(å‘æœåŠ¡å™¨ç«¯è¯·æ±‚æŸ¥è¯¢åŠŸèƒ½)-äº¤ç”±æ’ä»¶å‘æœåŠ¡å™¨ç«¯å‘é€æŸ¥è¯¢è¯·æ±‚-å¤„ç†å“åº”-å›å¤<br>              -æƒ…å†µ2(åˆ†æç”¨æˆ·éœ€æ±‚ç”Ÿæˆå¯¹åº”æŒ‡ä»¤)-ç”±æ’ä»¶æ„å»ºè¯·æ±‚å‘æœåŠ¡å™¨è¯·æ±‚æ‰§è¡Œ-å¤„ç†å“åº”-å›å¤<br></code></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰æ’ä»¶å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚"><a href="#è‡ªå®šä¹‰æ’ä»¶å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚" class="headerlink" title="è‡ªå®šä¹‰æ’ä»¶å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚"></a>è‡ªå®šä¹‰æ’ä»¶å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚</h2><p>ç”± ä¸Šä¸€èŠ‚ä¸­çš„è®¾è®¡æµç¨‹æ¥çœ‹æˆ‘ä»¬è‡³å°‘éœ€è¦æ„å»ºä¸¤ä¸ªè¯·æ±‚ ï¼š</p><p>1 . Get è¯·æ±‚  å‘æœåŠ¡ç«¯è¯·æ±‚åº”ç”¨ç¨‹åºåˆ—è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Desktop_get</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>FetchKey = <span class="hljs-string">&quot;/key&quot;</span><br>Command = <span class="hljs-string">&quot;/command&quot;</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DestopHTool</span>(<span class="hljs-title class_ inherited__">Tool</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_invoke</span>(<span class="hljs-params">self, tool_parameters: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; Generator[ToolInvokeMessage]:<br>        ip = tool_parameters.get(<span class="hljs-string">&quot;ip&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        port = tool_parameters.get(<span class="hljs-string">&quot;port&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        key = <span class="hljs-variable language_">self</span>.fetch_key(ip,port)<br>        url = <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;ip&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span><span class="hljs-subst">&#123;Command&#125;</span>&quot;</span><br>        headers=&#123;<span class="hljs-string">&quot;X-Api-Key&quot;</span>:key&#125;<br>        res = requests.get(url=url,headers=headers,timeout=<span class="hljs-number">30</span>).json()<br>        <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">self</span>.create_text_message(<span class="hljs-built_in">str</span>(res[<span class="hljs-string">&quot;commands&quot;</span>])<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_key</span>(<span class="hljs-params">self,ip,port</span>) : <br>        url = <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;ip&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span><span class="hljs-subst">&#123;FetchKey&#125;</span>&quot;</span><br><br>        js = requests.get(url=url,timeout=<span class="hljs-number">30</span>).json()<br>        <span class="hljs-keyword">return</span> js[<span class="hljs-string">&quot;key&quot;</span>]<br></code></pre></td></tr></table></figure><ol start="2"><li>Post è¯·æ±‚ å‘æœåŠ¡ç«¯å‘é€å‘½ä»¤æ‰§è¡Œåˆ—è¡¨ï¼Œç”±æœåŠ¡ç«¯è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>EXEC=<span class="hljs-string">&quot;/execute&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DestopHelperTool</span>(<span class="hljs-title class_ inherited__">Tool</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_invoke</span>(<span class="hljs-params">self, tool_parameters: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; Generator[ToolInvokeMessage]:<br>        content = tool_parameters.get(<span class="hljs-string">&quot;text&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        ip = tool_parameters.get(<span class="hljs-string">&quot;ip&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        port = tool_parameters.get(<span class="hljs-string">&quot;port&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        url = <span class="hljs-string">f&quot;http://<span class="hljs-subst">&#123;ip&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span><span class="hljs-subst">&#123;EXEC&#125;</span>&quot;</span><br>        <span class="hljs-built_in">print</span>(url)<br>        key = tool_parameters.get(<span class="hljs-string">&quot;key&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        headers=&#123;<span class="hljs-string">&quot;X-Api-Key&quot;</span>:key,<span class="hljs-string">&quot;Content-Type&quot;</span>:<span class="hljs-string">&quot;application/json&quot;</span>&#125;<br>        <span class="hljs-built_in">print</span>(headers)<br>        res = requests.post(url=url,json=json.loads(content),headers=headers,timeout=<span class="hljs-number">30</span>).text<br>        <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">self</span>.create_text_message(res)<br><br></code></pre></td></tr></table></figure><h2 id="æ„å»ºæœåŠ¡å™¨ç«¯æ¥å£"><a href="#æ„å»ºæœåŠ¡å™¨ç«¯æ¥å£" class="headerlink" title="æ„å»ºæœåŠ¡å™¨ç«¯æ¥å£"></a>æ„å»ºæœåŠ¡å™¨ç«¯æ¥å£</h2><p>ä½¿ç”¨flask æ„å»ºä¸€ä¸ªæ¥æ”¶ä»¥ä¸Šè¯·æ±‚çš„æœåŠ¡ç¨‹åºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, request<br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> wraps<br><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> pexpect<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">require_key</span>(<span class="hljs-params">f</span>):<br><span class="hljs-meta">    @wraps(<span class="hljs-params">f</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorated_function</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        <span class="hljs-built_in">print</span>(request.headers)<br>        key = request.headers.get(<span class="hljs-string">&#x27;X-API-KEY&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(keys)<br>        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> keys:<br>            <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;error&#x27;</span>: <span class="hljs-string">&#x27;Invalid API key&#x27;</span>&#125;), <span class="hljs-number">401</span><br>        <span class="hljs-keyword">return</span> f(*args, **kwargs)<br>    <span class="hljs-keyword">return</span> decorated_function<br><br><span class="hljs-comment"># å¯†é’¥åˆ›å»ºè·¯ç”±</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/key&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_key</span>():<br>    key = <span class="hljs-built_in">str</span>(uuid.uuid4())<br>    keys[key] = <span class="hljs-literal">True</span><br>    <span class="hljs-built_in">print</span>(keys)<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;key&#x27;</span>: key&#125;)<br><br><span class="hljs-comment"># è·å–æ‰€æœ‰åŠŸèƒ½è·¯ç”±</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/command&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-meta">@require_key</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_functions</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># è·å–PATHç¯å¢ƒå˜é‡ä¸­çš„æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶</span><br>        result = subprocess.run([<span class="hljs-string">&#x27;ls&#x27;</span>, <span class="hljs-string">&#x27;/server/bin&#x27;</span>], capture_output=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>)<br>        commands = result.stdout.split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-string">&#x27;commands&#x27;</span>: commands&#125;)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-built_in">str</span>(e)&#125;)<br><span class="hljs-comment"># æ‰§è¡Œå‘½ä»¤è·¯ç”±</span><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/execute&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-meta">@require_key</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    æ‰§è¡Œä¼ å…¥çš„å‘½ä»¤å¹¶è¿”å›ç»“æœ</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    data = request.json<br>    <span class="hljs-built_in">print</span>(data)<br>    commands = data.get(<span class="hljs-string">&#x27;commands&#x27;</span>)<br>    result = []<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> commands:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;No command provided&#x27;</span>&#125;)<br>    <br>    <span class="hljs-keyword">try</span>:<br>        shell = pexpect.spawn(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>)<br>        <span class="hljs-keyword">for</span> command <span class="hljs-keyword">in</span> commands:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(command, <span class="hljs-built_in">dict</span>):<br>                <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>,<span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Invalid command format&#x27;</span>&#125;)<br>            command_line = []<br>            command_line.append(command[<span class="hljs-string">&quot;command&quot;</span>])<br>            command_line.extend(command[<span class="hljs-string">&quot;args&quot;</span>])<br>            cmd = <span class="hljs-string">&quot; &quot;</span>.join(command_line)<br>            marker = <span class="hljs-string">f&quot;CMD_END_<span class="hljs-subst">&#123;<span class="hljs-built_in">hash</span>(cmd)&#125;</span>&quot;</span><br>            shell.sendline(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;cmd&#125;</span>; echo &#x27;<span class="hljs-subst">&#123;marker&#125;</span>&#x27;&quot;</span>)<br>            shell.expect(marker)<br>            <span class="hljs-comment"># è·å–è¾“å‡º</span><br>            output = shell.before.decode().strip()<br>            <span class="hljs-built_in">print</span>(output)<br>            result.append( &#123;<br>                <span class="hljs-string">&#x27;command&#x27;</span>: cmd,<br>                <span class="hljs-string">&#x27;status&#x27;</span>:<span class="hljs-string">&#x27;success&#x27;</span>,<br>                <span class="hljs-string">&#x27;stdout&#x27;</span>: output,<br>            &#125;)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-built_in">str</span>(e)&#125;)<br>    shell.close()<br>    <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">return</span> jsonify(&#123;<span class="hljs-string">&quot;result&quot;</span>: result&#125;)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>Get è¯·æ±‚è¿”å›çš„æ¶ˆæ¯ä½“</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;commands&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;hexo&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;ls&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;lscpu&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;python&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;zip&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>Postè¯·æ±‚æ¥æ”¶çš„æ¶ˆæ¯ä½“</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;commands&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ls&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;-l&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;/home/codfish&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨æœ¬åœ°æ’ä»¶è°ƒè¯•å’ŒæœåŠ¡ç«¯</p><h2 id="æ‰§è¡Œå·¥ä½œæµ"><a href="#æ‰§è¡Œå·¥ä½œæµ" class="headerlink" title="æ‰§è¡Œå·¥ä½œæµ"></a>æ‰§è¡Œå·¥ä½œæµ</h2><p>å‘æœºå™¨äººè¯·æ±‚æŸ¥çœ‹æœåŠ¡ç«¯æä¾›çš„åº”ç”¨åˆ—è¡¨ ï¼š </p><p><img src="https://i.111666.best/image/lgRg7jkIDaRm4Fs8moXWkk.png" alt="image"></p><p>å‘æœºå™¨äººè¯·æ±‚æŸ¥è¯¢æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯ï¼š</p><p><img src="https://i.111666.best/image/PI0vurDrzyzDKmIyPWrGCh.jpg" alt="image"></p><p>è¯·æ±‚å®‰è£…python åº“ï¼š</p><p><img src="https://i.111666.best/image/fY63mSee5VABzV7CFrSHuu.png" alt="image"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å®Œæˆäº†åŸºæœ¬åŠŸèƒ½çš„å®ç°</p><p>åœ¨æŸäº›æƒ…å†µä¸‹æç¤ºè¯è¿˜æ˜¯ä¼šå‡ºç°å¼‚å¸¸ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WSL2+Dify é…ç½®å¤§æ¨¡å‹æ¡Œé¢ç«¯èµ„æºè®¿é—®(ç®€å•åº”ç”¨)</title>
    <link href="/2025/03/25/WSL2-Dify-%E9%85%8D%E7%BD%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE-%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8/"/>
    <url>/2025/03/25/WSL2-Dify-%E9%85%8D%E7%BD%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%A1%8C%E9%9D%A2%E7%AB%AF%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE-%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ä½¿ç”¨WSL2 åšäº†difyçš„æœ¬åœ°åŒ–éƒ¨ç½²ã€‚è¯•ç€ä½¿ç”¨å·¥ä½œæµçš„æ–¹å¼å®ç°ä¸€ä¸ªå·¥ä½œæµæ¥é€šè¿‡å’Œå¤§æ¨¡å‹å¯¹è¯å®Œæˆå¯¹æœ¬åœ°èµ„æºçš„è®¿é—®ã€‚</p><h1 id="é¢„é…ç½®"><a href="#é¢„é…ç½®" class="headerlink" title="é¢„é…ç½®"></a>é¢„é…ç½®</h1><h2 id="WSL2çš„æœ¬åœ°éƒ¨ç½²"><a href="#WSL2çš„æœ¬åœ°éƒ¨ç½²" class="headerlink" title="WSL2çš„æœ¬åœ°éƒ¨ç½²"></a>WSL2çš„æœ¬åœ°éƒ¨ç½²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">wsl --list  <span class="hljs-comment"># æŸ¥è¯¢æ”¯æŒçš„wslå­ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬</span><br>wsl --install <span class="hljs-comment"># å®‰è£…é»˜è®¤çš„wslå­ç³»ç»Ÿ</span><br></code></pre></td></tr></table></figure><p>éƒ¨ç½²å®Œæˆåï¼Œé…ç½®å®‰è£…aptæº ï¼ŒDockeræºï¼ˆé•œåƒæœ‰é—®é¢˜å¯ä»¥æŸ¥è¯¢ä¹‹å‰çš„æ–‡ç« ï¼‰ï¼ŒGité…ç½®ï¼Œä»¥åŠ ä¸€äº›åŸºæœ¬çš„å‘½ä»¤è¡Œå·¥å…·</p><h2 id="Dify-æœ¬åœ°éƒ¨ç½²"><a href="#Dify-æœ¬åœ°éƒ¨ç½²" class="headerlink" title="Dify æœ¬åœ°éƒ¨ç½²"></a>Dify æœ¬åœ°éƒ¨ç½²</h2><p>Github ä¸Š <a href="https://github.com/langgenius/dify">https://github.com/langgenius/dify</a> æœ‰éƒ¨ç½²æ•™ç¨‹ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> dify<br><span class="hljs-built_in">cd</span> docker<br><span class="hljs-built_in">cp</span> .env.example .<span class="hljs-built_in">env</span><br>docker compose up -d<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæ¯•å è®¿é—®æœ¬åœ°çš„<a href="http://localhost/install">http://localhost/install</a>  è¿›è¡Œç®¡ç†å‘˜é…ç½®</p><p>è‡³æ­¤æˆ‘ä»¬è·å¾—äº†ä¸€ä¸ªéƒ¨ç½²åœ¨æœ¬åœ°windowså­ç³»ç»Ÿä¸Šçš„difyç¯å¢ƒ</p><h1 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h1><p><img src="https://i.111666.best/image/YNLclFRYQ3PLOr79iU1PyH.png" alt="image"></p><p>ç›®æ ‡æ˜¯é€šè¿‡å’Œå¤§æ¨¡å‹å¯¹è¯ï¼Œè¯†åˆ«å…¶ä¸­çš„å…³é”®è¯æ¥å®Œæˆå’Œè‡ªå®šä¹‰æ’ä»¶ä¸­çš„åŠŸèƒ½çš„æ˜ å°„å…³ç³»ã€‚å‘æœ¬åœ°çš„HTTPæœåŠ¡å™¨å‘é€å¯¹åº”è¯·æ±‚ã€‚å®ŒæˆåŠŸèƒ½çš„æ‰§è¡Œ</p><p>ä¸€äº›æœªæ¥å¯è¡Œçš„æ‰©å±•é¡¹</p><ol><li>æ›´å¥½çš„æœåŠ¡é€šä¿¡æ–¹å¼ã€‚wsl2 å­ç³»ç»Ÿå¯ä»¥ç›´æ¥å¯¹æŒ‚è½½åˆ°è¯¥ç³»ç»Ÿçš„windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥å­˜åœ¨æ›´å¿«æ·æ–¹æ³•è°ƒç”¨æœ¬åœ°èµ„æºã€‚ä½†æ˜¯è¿™å¯èƒ½éœ€è¦difyæä¾›æ›´ä¸°å¯Œçš„è°ƒç”¨æ–¹å¼æˆ–è€…åœ¨dockerå±‚é¢ä¸Šè¿›è¡Œä¸€äº›åŠŸèƒ½å®šåˆ¶ï¼Œå½“å‰åªæ˜¯ä¸€ä¸ªå¯è¡Œæ€§å°è¯•ã€‚æ‰€ä»¥ä½¿ç”¨äº† httpçš„è°ƒç”¨-å“åº”æ¨¡å¼</li><li>æ³¨å†Œï¼Œ æä¾›ä¸€ä¸ªé€šç”¨çš„PCå¹³å°åº”ç”¨å‘ç°æœåŠ¡ã€‚è€Œä¸æ˜¯é€šè¿‡å°†æ‰€æœ‰çš„å¯æ‰§è¡Œç¨‹åºæ³¨å†Œä¸ºDifyçš„è‡ªå®šä¹‰æ’ä»¶åŠŸèƒ½ã€‚è¿™æ ·æ›´åŠ çµæ´»</li><li>æœ¬åœ°çš„éƒ¨ç½²+è‡ªç„¶è¯­è¨€çš„è¯·æ±‚+æ’ä»¶è‡ªå®šä¹‰åŠŸèƒ½çš„è§£è€¦ ç›®å‰æ¥çœ‹ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒå®‰å…¨ã€‚å¦‚æœéœ€è¦å®ç°è¿œç¨‹çš„è¯·æ±‚è°ƒç”¨å¯èƒ½éœ€è¦æ›´åŠ å®‰å…¨çš„ä¿¡æ¯ä¼ è¾“æ–¹å¼</li><li>åœ¨æœ¬åœ°æ·»åŠ åº”ç”¨ç¨‹åºå’Œæ–‡ä»¶èµ„æºçš„è°ƒç”¨è®°å½•ã€‚</li></ol><h1 id="Difyçš„è‡ªå®šä¹‰æ’ä»¶"><a href="#Difyçš„è‡ªå®šä¹‰æ’ä»¶" class="headerlink" title="Difyçš„è‡ªå®šä¹‰æ’ä»¶"></a>Difyçš„è‡ªå®šä¹‰æ’ä»¶</h1><h2 id="è„šæ‰‹æ¶å·¥å…·åˆå§‹åŒ–"><a href="#è„šæ‰‹æ¶å·¥å…·åˆå§‹åŒ–" class="headerlink" title="è„šæ‰‹æ¶å·¥å…·åˆå§‹åŒ–"></a>è„šæ‰‹æ¶å·¥å…·åˆå§‹åŒ–</h2><p>å®˜æ–¹æ–‡æ¡£</p><p><a href="https://docs.dify.ai/zh-hans/plugins/quick-start/develop-plugins/initialize-development-tools">https://docs.dify.ai/zh-hans/plugins/quick-start/develop-plugins/initialize-development-tools</a></p><p>ä¸‹è½½ Difyçš„æ’ä»¶è„šæ‰‹æ¶å·¥å…· <a href="https://github.com/langgenius/dify-plugin-daemon/tags">https://github.com/langgenius/dify-plugin-daemon/tags</a></p><p>ä»¥tools ç±»å‹ä¸ºä¾‹  åˆå§‹åŒ– æ’ä»¶é¡¹ç›®ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dify-plugin-windows-amd64 plugin init <br></code></pre></td></tr></table></figure><p><img src="https://i.111666.best/image/36KrL8MFwMSB0kHm0M7VGs.png" alt="image"><br>name åˆ›å»º æ’ä»¶å</p><p>author æ’ä»¶ä½œè€…</p><p>description æ’ä»¶åŠŸèƒ½æè¿°</p><p>è¯­è¨€ : python</p><p>å·¥å…· : tools  (è‡ªå®šä¹‰tools ç±»å‹æ’ä»¶</p><p><img src="https://i.111666.best/image/htD6C2oNrddvAuEyXVdmep.png" alt="image"></p><p>ä¸€äº›æƒé™çš„è®¾ç½®</p><p>æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªè¿™æ ·çš„å·¥ç¨‹</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›æ¯”è¾ƒé‡è¦çš„æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">- _assets  <span class="hljs-comment"># å­˜æ”¾ä¸€äº›å¼•ç”¨èµ„æº</span><br>- provider <span class="hljs-comment"># </span><br>  - someplugin.py <span class="hljs-comment"># è¿›è¡Œä¸€äº›å¼‚å¸¸å¤„ç†</span><br>- someplugin.yaml <span class="hljs-comment"># æ’ä»¶åŠŸèƒ½/èµ„æºæè¿° </span><br>- tools    <span class="hljs-comment"># å…·ä½“çš„toolsåŠŸèƒ½å®ç°</span><br>- somefunction.py <span class="hljs-comment"># å…·ä½“çš„åŠŸèƒ½å®ç°</span><br>- somefunction.yaml <span class="hljs-comment"># åŠŸèƒ½/èµ„æºæè¿°</span><br>- main.py <span class="hljs-comment"># å‡½æ•°å…¥å£</span><br>- manifest.yaml <span class="hljs-comment">#  æ’ä»¶æè¿°</span><br> <br></code></pre></td></tr></table></figure><h2 id="æ’ä»¶åŠŸèƒ½å®šä¹‰"><a href="#æ’ä»¶åŠŸèƒ½å®šä¹‰" class="headerlink" title="æ’ä»¶åŠŸèƒ½å®šä¹‰"></a>æ’ä»¶åŠŸèƒ½å®šä¹‰</h2><p>æ’ä»¶é€šè¿‡è°ƒç”¨çš„æ˜¯_invokeæ–¹æ³•æ¥æ‰§è¡Œå¯¹åº”çš„åŠŸèƒ½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections.abc <span class="hljs-keyword">import</span> Generator<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span><br><br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">from</span> dify_plugin <span class="hljs-keyword">import</span> Tool<br><span class="hljs-keyword">from</span> dify_plugin.entities.tool <span class="hljs-keyword">import</span> ToolInvokeMessage<br><br>BASE_URL =<span class="hljs-string">&quot;&lt;http://localhost:8080&gt;&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DestopHTool</span>(<span class="hljs-title class_ inherited__">Tool</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_invoke</span>(<span class="hljs-params">self, tool_parameters: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; Generator[ToolInvokeMessage]:<br>        method = tool_parameters.get(<span class="hljs-string">&quot;method&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>        result = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> method == <span class="hljs-string">&quot;desktop_get&quot;</span> :<br>            result = requests.get(BASE_URL).text<br>        <span class="hljs-keyword">yield</span>  <span class="hljs-variable language_">self</span>.create_text_message(<span class="hljs-string">f&#x27;è°ƒç”¨äº†<span class="hljs-subst">&#123;method&#125;</span>,è¿”å›<span class="hljs-subst">&#123;result&#125;</span>&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„httpè¯·æ±‚è°ƒç”¨ï¼Œä½¿ç”¨requestæ¨¡æ‹Ÿhttp get è¯·æ±‚ã€‚å¹¶è¿”å›æ¥æ”¶åˆ°çš„æ¶ˆæ¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">identity:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">desktop_get</span>      <span class="hljs-comment"># æ–¹æ³•å</span><br>  <span class="hljs-attr">author:</span> <span class="hljs-string">codfish</span><br>  <span class="hljs-attr">label:</span><br>    <span class="hljs-attr">en_US:</span> <span class="hljs-string">destop_get</span><br>    <span class="hljs-attr">zh_Hans:</span> <span class="hljs-string">destop_get</span><br>    <span class="hljs-attr">pt_BR:</span> <span class="hljs-string">destop_get</span><br><span class="hljs-attr">description:</span><br>  <span class="hljs-attr">human:</span><br>    <span class="hljs-attr">en_US:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>    <span class="hljs-attr">zh_Hans:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>    <span class="hljs-attr">pt_BR:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>  <span class="hljs-attr">llm:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br><span class="hljs-attr">parameters:</span>       <span class="hljs-comment">#è‡ªå®šä¹‰å‚æ•°</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">url</span>     <span class="hljs-comment">#å‚æ•°å</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>  <span class="hljs-comment">#å‚æ•°ç±»å‹</span><br>    <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">label:</span><br>      <span class="hljs-attr">en_US:</span> <span class="hljs-string">Query</span> <span class="hljs-string">string</span><br>      <span class="hljs-attr">zh_Hans:</span> <span class="hljs-string">æŸ¥è¯¢è¯­å¥</span><br>      <span class="hljs-attr">pt_BR:</span> <span class="hljs-string">Query</span> <span class="hljs-string">string</span><br>    <span class="hljs-attr">human_description:</span><br>      <span class="hljs-attr">en_US:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>      <span class="hljs-attr">zh_Hans:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>      <span class="hljs-attr">pt_BR:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>    <span class="hljs-attr">llm_description:</span> <span class="hljs-string">a</span> <span class="hljs-string">interface</span> <span class="hljs-string">design</span> <span class="hljs-string">for</span> <span class="hljs-string">destop_application_oprating</span> <br>    <span class="hljs-attr">form:</span> <span class="hljs-string">llm</span><br><span class="hljs-attr">extra:</span><br>  <span class="hljs-attr">python:</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">tools/desktop_get.py</span>  <span class="hljs-comment">#å¯¹åº”çš„pythonå®ç°æ–‡ä»¶</span><br><br></code></pre></td></tr></table></figure><p>æ¯ä¸ªtools æ’ä»¶å…è®¸æ·»åŠ å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éœ€è¦å®šä¹‰è‡ªå·±çš„æ¨¡å—æ–‡ä»¶(.py)å’Œèµ„æºæè¿°æ–‡ä»¶ï¼ˆ.yamlï¼‰</p><p>å…¶ç»“æ„ä¸º</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">tools\\</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">somefunction1.py</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">somefunction1.yaml</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">somefunction2.py</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">somefunction2.yaml</span><br>  <span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><h2 id="æ’ä»¶è°ƒè¯•"><a href="#æ’ä»¶è°ƒè¯•" class="headerlink" title="æ’ä»¶è°ƒè¯•"></a>æ’ä»¶è°ƒè¯•</h2><p>é€šè¿‡ä¿®æ”¹å·¥ä½œç›®å½•ä¸­çš„.env.example ä¸º.env</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">INSTALL_METHOD=remote</span><br><span class="hljs-string">REMOTE_INSTALL_HOST=debug.dify.ai</span><br><span class="hljs-string">REMOTE_INSTALL_PORT=5003</span><br><span class="hljs-string">REMOTE_INSTALL_KEY=some_install_key</span><br></code></pre></td></tr></table></figure><p>å°†difyæ’ä»¶é¡µçš„è°ƒè¯•ä¿¡æ¯å¡«å……åˆ°.envä¸­ï¼Œæœ¬åœ°æ‰§è¡Œmainæ–¹æ³•ï¼Œæ’ä»¶ä¼šè¢«åŠ è½½åˆ°difyçš„æ’ä»¶åˆ—è¡¨ä¸­</p><p><img src="https://i.111666.best/image/TmrbwxdMkhWRuygRCXbdGp.png" alt="image"></p><h2 id="åˆ›å»ºCHATä»»åŠ¡æµ"><a href="#åˆ›å»ºCHATä»»åŠ¡æµ" class="headerlink" title="åˆ›å»ºCHATä»»åŠ¡æµ"></a>åˆ›å»ºCHATä»»åŠ¡æµ</h2><p><img src="https://i.111666.best/image/2IgA1P69jBp6amaeczz6ZT.png" alt="image"></p><p>åˆ›å»ºå¤§æ¨¡å‹ç»„ä»¶ï¼Œå¹¶å¡«å…¥æ¨¡å‹ï¼Œå›½å†…æ¨èä½¿ç”¨ç¡…åŸºæµåŠ¨ã€‚</p><p>åœ¨å¤§æ¨¡å‹ç»„ä»¶ä¸­å¡«å…¥æ¨¡å‹ï¼Œå¡«å…¥ç³»ç»Ÿæç¤ºè¯ï¼Œæ ¸å¿ƒç›®çš„æ˜¯é¢„æœŸè¾“å‡ºåˆç†ä¸”å¯æ§ï¼Œä¸è¦æœ‰å¤šä½™çš„è¾“å‡ºï¼Œæµ‹è¯•çš„ç³»ç»Ÿæç¤ºè¯å¦‚ä¸‹(å¹¶ä¸èƒ½å¾ˆå¥½çš„è·å–åˆ°ç›®æ ‡æ–¹æ³•åï¼Œéœ€è¦åæœŸå†è°ƒè¯•)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">## è§’è‰²</span><br><span class="hljs-string">ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ¡Œé¢åŠ©ç†</span><br><span class="hljs-comment">## ä»»åŠ¡</span><br><span class="hljs-string">å½“ç”¨æˆ·å‘é€æŸ¥è¯¢æ¡Œé¢çš„è¯·æ±‚æ—¶ï¼Œä½ å¯ä»¥æ ¹æ®å¯¹è¯ä¿¡æ¯æ£€æŸ¥æ˜¯å¦è¿”å›ä¸€ä¸ªè°ƒç”¨æ–¹æ³•</span><br><span class="hljs-comment">## å½“å‰æ”¯æŒçš„æ–¹æ³•è¡¨</span><br><span class="hljs-string">å‘èµ·æ¡Œé¢è¯·æ±‚</span> <span class="hljs-string">=</span> <span class="hljs-string">destop_get</span><br><span class="hljs-comment">## æ³¨æ„</span><br><span class="hljs-string">ä¸éœ€è¦</span> <span class="hljs-string">ç›´æ¥å›ç­”ç”¨æˆ·è¯·æ±‚ï¼Œåªéœ€è¦è¿”å›ä¸€ä¸ªå…·ä½“çš„æ‰§è¡Œæ–¹æ³•</span><br></code></pre></td></tr></table></figure><p>åœ¨åç»­æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶ä½œä¸ºèŠ‚ç‚¹ï¼Œ æ¥æ”¶å¤§æ¨¡å‹çš„è¿”å›ä½œä¸ºè¾“å…¥çš„å‚æ•°ï¼Œè¿›è¡Œåç»­æ‰§è¡Œ</p><p><img src="https://i.111666.best/image/TUxQf8y6eXGsVkuHSLivNL.png" alt="image"></p><p>ä¸€ä¸ªåŸºç¡€çš„å·¥ä½œé“¾æ¡  å¯åŠ¨å¤§æ¨¡å‹â†’å‘èµ·è¯·æ±‚â†’ æ ¹æ®è¯·æ±‚ç»™å‡ºéœ€è¦æ‰§è¡Œçš„æ–¹æ³•â†’ä¼ é€’ç»™æ’ä»¶æ‰§è¡Œæ–¹æ³•â†’è¿”å›æ‰§è¡Œç»“æœ</p><p>å¤§æ¨¡å‹æ­£ç¡®è¯†åˆ«æ–¹æ³•åï¼Œæ’ä»¶è§£ææ–¹æ³•ï¼Œæ‰§è¡Œå¯¹åº”æ–¹æ³•ã€‚å‘æœ¬åœ°å¯åŠ¨çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚å¾—åˆ°å“åº”è¿”å›ç»“æœåˆ°å¯¹è¯æ¡†</p><p><img src="https://i.111666.best/image/hdRpQxHTCHkU6fLsuc3BTm.png" alt="image"></p>]]></content>
    
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå®¹å™¨é•œåƒæº</title>
    <link href="/2025/03/21/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%BA%90/"/>
    <url>/2025/03/21/Docker%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<h2 id="Docker-å®¹å™¨é•œåƒæ‹‰å–çš„é—®é¢˜"><a href="#Docker-å®¹å™¨é•œåƒæ‹‰å–çš„é—®é¢˜" class="headerlink" title="Docker å®¹å™¨é•œåƒæ‹‰å–çš„é—®é¢˜"></a>Docker å®¹å™¨é•œåƒæ‹‰å–çš„é—®é¢˜</h2><p>ä½¿ç”¨docker pull æˆ–è€… docker compose up -d æ‹‰å–é•œåƒæ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ã€‚</p><p>Error response from daemon: Get â€œ<a href="https://registry-1.docker.io/v2/">https://registry-1.docker.io/v2/</a>â€œ: net&#x2F;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</p><p>åŸå› æ˜¯é•œåƒæºå¤±æ•ˆæˆ–è€…é€Ÿç‡ä¸å¤Ÿå¯¼è‡´è¶…æ—¶</p><p>ç»å¤§éƒ¨åˆ†çš„æ–‡ç« éƒ½ä¸ç”¨çœ‹ï¼Œå› ä¸ºå¤±æ•ˆå¾ˆå¿«</p><p>å¯ä»¥åœ¨Githubä¸Šå…³æ³¨è¿™ä¸ªé¡¹ç›®éšæ—¶æ›´æ–°æº</p><p><a href="https://github.com/dongyubin/DockerHub">https://github.com/dongyubin/DockerHub</a></p><p>ç„¶åä¿®æ”¹æœ¬åœ°daemon.json é…ç½®</p><p>cat &#x2F;etc&#x2F;docker&#x2F;daemon.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;registry-mirrors&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>   <span class="hljs-string">&quot;https://docker.mybacc.com&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-string">&quot;https://docker.1ms.run&quot;</span><span class="hljs-punctuation">,</span><br>   <span class="hljs-string">&quot;https://dytt.online&quot;</span><br> <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>é‡å¯daemonå’Œdocker æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br>systemctl restart docker <br></code></pre></td></tr></table></figure><h2 id="é¡ºä¾¿è®°å½•ä¸‹Podmançš„æºé…ç½®"><a href="#é¡ºä¾¿è®°å½•ä¸‹Podmançš„æºé…ç½®" class="headerlink" title="é¡ºä¾¿è®°å½•ä¸‹Podmançš„æºé…ç½®"></a>é¡ºä¾¿è®°å½•ä¸‹Podmançš„æºé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@iZbp19tqlmjz1dmnm8w43uZ containers]# <span class="hljs-built_in">cat</span> /etc/containers/registries.conf | grep -v <span class="hljs-string">&quot;#&quot;</span><br><br>unqualified-search-registries = [<span class="hljs-string">&quot;registry.access.redhat.com&quot;</span>, <span class="hljs-string">&quot;registry.redhat.io&quot;</span>, <span class="hljs-string">&quot;docker.io&quot;</span>]<br><br><br><br>[[registry]]<br>prefix = <span class="hljs-string">&quot;docker.io&quot;</span><br>location = <span class="hljs-string">&quot;docker.1ms.run&quot;</span><br>insecure = <span class="hljs-literal">false</span><br><br>[[registry.mirror]]<br>location = <span class="hljs-string">&quot;docker.mybacc.com&quot;</span><br>insecure = <span class="hljs-literal">false</span><br><br>[[registry.mirror]]<br>location = <span class="hljs-string">&quot;docker.1ms.run&quot;</span><br>insecure = <span class="hljs-literal">false</span><br><br>[[registry.mirror]]<br>location = <span class="hljs-string">&quot;dytt.online&quot;</span><br>insecure = <span class="hljs-literal">false</span><br><br><br><br>short-name-mode = <span class="hljs-string">&quot;permissive&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºHEXOçš„åšå®¢æ­å»º</title>
    <link href="/2025/03/21/%E5%9F%BA%E4%BA%8EHEXO%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    <url>/2025/03/21/%E5%9F%BA%E4%BA%8EHEXO%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºäºHEXO-FLUID-æ ·å¼çš„åšå®¢æ­å»º"><a href="#åŸºäºHEXO-FLUID-æ ·å¼çš„åšå®¢æ­å»º" class="headerlink" title="åŸºäºHEXO+FLUID æ ·å¼çš„åšå®¢æ­å»º"></a>åŸºäºHEXO+FLUID æ ·å¼çš„åšå®¢æ­å»º</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><ol><li><p>7.3ç‰ˆæœ¬çš„Hexo è¦æ±‚node.js çš„ç‰ˆæœ¬åœ¨18.0ä»¥ä¸Šï¼Œcentos7 æ‰€èƒ½æ‹‰å–åˆ°çš„node.js ç‰ˆæœ¬åœ¨11.0 ã€‚è€ƒè™‘åˆ°éœ€è¦å¤„ç†ä¾èµ–æ‰€ä»¥ç›´æ¥æ¢æˆäº†alibaba cloud ç³»ç»Ÿ</p></li><li><p>å®‰è£… npmå’Œhexo-cli å‘½ä»¤è¡Œå·¥å…·</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dnf install npm<br>npm install hexo-cli -g<br></code></pre></td></tr></table></figure></li><li><p>Github é›†æˆ</p><p> å› ä¸ºåç»­éœ€è¦è®¾ç½®åˆ°github page ï¼Œæ‰€ä»¥å…ˆé…ç½®gitå’Œå¯†é’¥</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>ssh-keygen  <span class="hljs-comment"># ä½¿ç”¨ssh-keygen åˆ›å»ºå¯†é’¥</span><br><span class="hljs-built_in">cat</span> /root/.ssh/id_rsa.pub  <span class="hljs-comment"># ä»ç›®å½•æ–‡ä»¶å¤¹æŸ¥è¯¢å…¬é’¥ï¼Œ </span><br><span class="hljs-comment"># é…ç½®åˆ°github  -&gt; settings -&gt; SSH and GPG keys -&gt; New SSH key</span><br><br>dnf install git   <span class="hljs-comment"># å®‰è£…git</span><br><br>git config --global user.name <span class="hljs-string">&quot;ç”¨æˆ·å&quot;</span><br>git config --global user.email <span class="hljs-string">&quot;é‚®ç®±&quot;</span><br>    <br>ssh -T git@github.com  <span class="hljs-comment"># æµ‹è¯•åˆ°githubçš„è¿æ¥</span><br><br></code></pre></td></tr></table></figure></li></ol><h2 id="HEXO-æ¡†æ¶å®‰è£…"><a href="#HEXO-æ¡†æ¶å®‰è£…" class="headerlink" title="HEXO æ¡†æ¶å®‰è£…"></a>HEXO æ¡†æ¶å®‰è£…</h2><p>åˆå§‹åŒ–hexo ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo init myhexo/  <span class="hljs-comment">#  åˆå§‹åŒ–æ–‡ä»¶å¤¹</span><br><span class="hljs-built_in">cd</span> myhexo  <span class="hljs-comment"># ç§»åŠ¨åˆ°åšå®¢ç›®å½•</span><br>npm install hexo-deployer-git --save  <span class="hljs-comment"># å®‰è£…å¹¶å­˜å‚¨hexoé¡¹ç›®</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹éƒ¨ç½²æ–¹å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span>         <span class="hljs-comment"># ç±»å‹æ˜¯ git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">git@github.com:username/username.github.io.git</span>    <br>  <span class="hljs-comment">#åœ¨githubä¸Šåˆ›å»ºusername.github.ioçš„ä»“åº“,ç¡®è®¤ä»“åº“åæ˜¯å¦ä¸€è‡´ï¼ </span><br>  <span class="hljs-comment">#è¿™é‡Œå¯ä»¥ä½¿ç”¨sshçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨httpsçš„æ–¹å¼ï¼Œä½†æ˜¯sshæ›´ç¨³å®š</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># è®¾ç½®åˆ†æ”¯ä¸ºmaster</span><br><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å ä½¿ç”¨ hexo deploy è¿›è¡Œå®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç â€˜</p><p>ç”¨æˆ·åå°±æ˜¯ç™»å½•è´¦æˆ·çš„åç§°</p><p>å¯†ç éœ€è¦é€šè¿‡ settings â†’ Developer Settings â†’ Personal access tokens â†’ Generate new token åˆ›å»ºtoken  ä½œä¸ºå¯†ç  </p><p>ç­‰å¾…å‡ åˆ†é’Ÿå¯ä»¥é€šè¿‡è®¿é—® <a href="https://username.github.io/">https://username.github.io</a> æŸ¥çœ‹æ˜¯å¦åˆ›å»ºæˆåŠŸ</p><h2 id="æ’ä»¶å®‰è£…"><a href="#æ’ä»¶å®‰è£…" class="headerlink" title="æ’ä»¶å®‰è£…"></a>æ’ä»¶å®‰è£…</h2><p>hexo æ”¯æŒå¤šç§æ ·å¼é£æ ¼çš„æ’ä»¶</p><p>ä»¥å®‰è£…fluidä¸ºä¾‹ ï¼Œ å®‰è£…æ’ä»¶ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">--save</span> <span class="hljs-string">hexo-theme-fluid</span><br></code></pre></td></tr></table></figure><p>è¿™æ—¶å¯ä»¥å°† ä¸‹è½½å¯¹åº”ä¸»é¢˜æ–‡ä»¶ æ”¾åˆ°theme æ–‡ä»¶å¤¹ï¼Œåœ¨_config.ymlé…ç½®theme ä¸ºfluid</p><p>æˆ–è€…ç›´æ¥åœ¨æ ¹ç›®å½•åˆ›å»º _config.fluid.yml  æ¥è¿›è¡Œé…ç½®ã€‚ _config.fluid.yml çš„é…ç½®ä¼˜å…ˆçº§é«˜äº _config.yml  ã€‚ ä¸€äº›åŸºæœ¬é…ç½® ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment">#æ ‡ç­¾é¡µä¸»é¢˜</span><br><span class="hljs-attr">language:</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment">#è¯­è¨€</span><br><span class="hljs-attr">timezone:</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment">#æ—¶åŒº</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment">#ä¸»é¢˜</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo new page about  <span class="hljs-comment"># å…³äºé¡µéœ€è¦è‡ªè¡Œåˆ›å»º</span><br></code></pre></td></tr></table></figure><p>æ‰©å±•é…ç½®å¯ä»¥å‚è€ƒ ï¼š <a href="https://fluid-dev.github.io/hexo-fluid-docs/">https://fluid-dev.github.io/hexo-fluid-docs/</a></p><p>åœ¨è°ƒè¯•æ—¶ å¯ä»¥é€šè¿‡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">hexo</span> <span class="hljs-string">g</span> <span class="hljs-string">--debug</span> <span class="hljs-string">æ¥æŸ¥çœ‹å…·ä½“çš„é…ç½®ä¿¡æ¯</span>  <span class="hljs-string">å¦‚å½’æ¡£æ ‡ç­¾é¡µçš„é…ç½®ä¿¡æ¯</span><br><br>  <span class="hljs-attr">&quot;archive&quot;:</span> &#123;<br>    <span class="hljs-attr">&quot;banner_img&quot;:</span> <span class="hljs-string">&quot;/img/default.png&quot;</span>,   <span class="hljs-comment"># æŒ‡å®šèƒŒæ™¯å›¾ç‰‡</span><br>    <span class="hljs-attr">&quot;banner_img_height&quot;:</span> <span class="hljs-number">60</span>,  <span class="hljs-comment"># å›¾ç‰‡å å…¨å±çš„æ¯”ä¾‹</span><br>    <span class="hljs-attr">&quot;banner_mask_alpha&quot;:</span> <span class="hljs-number">0.3</span>   <span class="hljs-comment"># ä¸é€æ˜åº¦</span><br>  &#125;<span class="hljs-string">,</span><br><br></code></pre></td></tr></table></figure><p>æ¯æ¬¡ä¿®æ”¹åéœ€è¦ä½¿ç”¨hexo clean å†è¿›è¡Œ ç”Ÿæˆå’Œéƒ¨ç½²ã€‚</p><p>ç„¶åå°±å¯ä»¥å¼€å§‹ åˆ›å»ºæ–‡ç« äº†,åˆ›å»ºåä¼šæç¤ºä½ mdæ–‡ä»¶çš„åœ°å€ï¼Œå°±å¯ä»¥è¿›è¡Œç¼–è¾‘äº†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">hexo</span> <span class="hljs-string">new</span> <span class="hljs-string">&quot;hello world&quot;</span><br></code></pre></td></tr></table></figure><p>ç›¸å…³å†…å®¹ ï¼š <a href="https://hexo.io/zh-cn/">https://hexo.io/zh-cn/</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>ç¯å¢ƒæ­å»º</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
